<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test du Script d'Exclusion</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #333; 
            text-align: center;
            margin-bottom: 30px;
        }
        .console-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
            white-space: pre-wrap;
            margin: 20px 0;
        }
        .instructions {
            background-color: #e6f3ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #3182ce;
        }
        button {
            background-color: #3182ce;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #2c5282;
        }
        .success { color: #48bb78; }
        .error { color: #f56565; }
        .info { color: #4299e1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test du Syst√®me d'Exclusion</h1>
        
        <div class="instructions">
            <h3>Instructions</h3>
            <p>Cliquez sur le bouton ci-dessous pour ex√©cuter le test de validation du syst√®me d'exclusion. Les r√©sultats s'afficheront dans la console simul√©e.</p>
            <p><strong>Note :</strong> Vous pouvez aussi ouvrir la console de d√©veloppement (F12) pour voir les vrais messages.</p>
        </div>

        <button onclick="runExclusionTest()">üöÄ Ex√©cuter le Test d'Exclusion</button>
        <button onclick="clearConsole()">üßπ Effacer la Console</button>

        <div id="console-output" class="console-output">
            Cliquez sur "Ex√©cuter le Test d'Exclusion" pour voir les r√©sultats...
        </div>
    </div>

    <script>
        let consoleDiv = document.getElementById('console-output');

        function clearConsole() {
            consoleDiv.innerHTML = 'Console effac√©e. Cliquez sur "Ex√©cuter le Test d\'Exclusion" pour relancer le test...';
        }

        function logToDiv(message, type = 'normal') {
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'info' ? 'info' : '';
            const span = className ? `<span class="${className}">${message}</span>` : message;
            consoleDiv.innerHTML += span + '\n';
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function runExclusionTest() {
            consoleDiv.innerHTML = '';
            logToDiv('üß™ Test du syst√®me d\'exclusion HEF, HEE, HEI, HEJ', 'info');

            // Simuler la fonction getExcludedPositions
            function getExcludedPositions(refType, placeType) {
                const exclusionRules = {
                    'entiere': {
                        '3/4': [],
                        '1/2': ['E', 'F', 'I', 'J'], // NOUVELLES EXCLUSIONS
                        '1/4': [],
                        'custom': []
                    },
                    '3/4': {
                        'entiere': [],
                        '1/2': [],
                        '1/4': []
                    },
                    '1/2': {
                        'entiere': [],
                        '3/4': [],
                        '1/4': []
                    },
                    '1/4': {
                        'entiere': [],
                        '3/4': [],
                        '1/2': []
                    }
                };
                
                return exclusionRules[refType]?.[placeType] || [];
            }

            // Simuler la fonction getLetterForPosition simplifi√©e
            function testGetLetterForPosition(basePosition, placementBrickType, referenceBrickType) {
                const excludedPositions = getExcludedPositions(referenceBrickType, placementBrickType);
                
                // V√©rifier si cette position est exclue
                if (excludedPositions.includes(basePosition)) {
                    return null; // Position exclue
                }
                
                // Syst√®me de lettrage simplifi√© pour le test
                const combinedLetteringSystems = {
                    '1/2_entiere': {
                        panneresse: { A: 'HEA', B: 'HEB', C: 'HEC', D: 'HED', E: 'HEE', F: 'HEF', G: 'HEG', H: 'HEH', I: 'HEI', J: 'HEJ' },
                        boutisse: { S: 'HES', T: 'HET', U: 'HEU', V: 'HEV' }
                    }
                };
                
                const systemKey = `${placementBrickType}_${referenceBrickType}`;
                const orientation = ['S', 'T', 'U', 'V'].includes(basePosition) ? 'boutisse' : 'panneresse';
                const system = combinedLetteringSystems[systemKey];
                
                return system && system[orientation] && system[orientation][basePosition];
            }

            // Tests des positions qui DOIVENT √™tre exclues
            logToDiv('\nüö´ Test des positions EXCLUES (doivent retourner null):', 'info');
            const excludedPositions = ['E', 'F', 'I', 'J'];
            let excludedSuccess = 0;
            excludedPositions.forEach(pos => {
                const result = testGetLetterForPosition(pos, '1/2', 'entiere');
                const isCorrect = result === null;
                const status = isCorrect ? '‚úÖ EXCLU' : `‚ùå ERREUR: ${result}`;
                logToDiv(`Position ${pos}: ${status}`, isCorrect ? 'success' : 'error');
                if (isCorrect) excludedSuccess++;
            });

            // Tests des positions qui DOIVENT √™tre autoris√©es
            logToDiv('\n‚úÖ Test des positions AUTORIS√âES (doivent retourner une lettre):', 'info');
            const allowedPositions = ['A', 'B', 'C', 'D', 'G', 'H', 'S', 'T', 'U', 'V'];
            let allowedSuccess = 0;
            allowedPositions.forEach(pos => {
                const result = testGetLetterForPosition(pos, '1/2', 'entiere');
                const isCorrect = result !== null;
                const status = isCorrect ? `‚úÖ AUTORIS√â: ${result}` : '‚ùå ERREUR: null';
                logToDiv(`Position ${pos}: ${status}`, isCorrect ? 'success' : 'error');
                if (isCorrect) allowedSuccess++;
            });

            // Test de comparaison avec brique enti√®re sur enti√®re
            logToDiv('\nüîÑ Test de comparaison avec enti√®re sur enti√®re:', 'info');
            let comparisonSuccess = 0;
            excludedPositions.forEach(pos => {
                const result = testGetLetterForPosition(pos, 'entiere', 'entiere');
                const expected = `EE${pos}`;
                const isCorrect = result === expected;
                const status = isCorrect ? `‚úÖ OK: ${result}` : `‚ùå ERREUR: ${result}`;
                logToDiv(`Position ${pos}: ${status}`, isCorrect ? 'success' : 'error');
                if (isCorrect) comparisonSuccess++;
            });

            // R√©sum√© final
            logToDiv('\nüìä R√©sum√© des tests:', 'info');
            logToDiv(`- Positions exclues: ${excludedSuccess}/${excludedPositions.length} r√©ussies`, excludedSuccess === excludedPositions.length ? 'success' : 'error');
            logToDiv(`- Positions autoris√©es: ${allowedSuccess}/${allowedPositions.length} r√©ussies`, allowedSuccess === allowedPositions.length ? 'success' : 'error');
            logToDiv(`- Test de comparaison: ${comparisonSuccess}/${excludedPositions.length} r√©ussies`, comparisonSuccess === excludedPositions.length ? 'success' : 'error');
            
            const totalTests = excludedPositions.length + allowedPositions.length + excludedPositions.length;
            const totalSuccess = excludedSuccess + allowedSuccess + comparisonSuccess;
            logToDiv(`\nüéØ Score total: ${totalSuccess}/${totalTests} tests r√©ussis`, totalSuccess === totalTests ? 'success' : 'error');
            
            if (totalSuccess === totalTests) {
                logToDiv('\nüéâ SUCC√àS ! Le syst√®me d\'exclusion fonctionne correctement.', 'success');
            } else {
                logToDiv('\n‚ö†Ô∏è Des erreurs ont √©t√© d√©tect√©es dans le syst√®me d\'exclusion.', 'error');
            }
        }
    </script>
</body>
</html>