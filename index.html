<!DOCTYPE html>
<!--
    WalSim5D - Simulateur de Construction Murale
    Copyright (c) 2025. Tous droits réservés.
    
    Ce logiciel est protégé par la licence MIT.
    Voir le fichier LICENSE pour plus de détails.
    
    Utilisation commerciale non autorisée sans permission expresse.
-->
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, viewport-fit=cover">
    <title>WallSim3D v1.0 - Simulateur de Construction de Murs</title>
    
    <!-- SYSTÈME DE STYLES UNIFIÉ -->
    <!-- 1. Variables CSS globales MODERNES (À CHARGER EN PREMIER) -->
    <link rel="stylesheet" href="styles/theme-modern-unified.css">
    <link rel="stylesheet" href="styles/theme-unified.css">
    <link rel="stylesheet" href="styles/professional-interface.css">
    
    <!-- 2. Composants standardisés -->
    <link rel="stylesheet" href="styles/unified-components.css">
    
    <!-- 3. Uniformisation générale (nouvelle couche) -->
    <link rel="stylesheet" href="styles/style-uniformity.css">
    
    <!-- 4. FEUILLES DE STYLE SPÉCIFIQUES -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/library-fix.css">
    <link rel="stylesheet" href="styles/library-professional.css">
    <link rel="stylesheet" href="styles/joints-control.css">
    <link rel="stylesheet" href="styles/modern-interface.css">
    <link rel="stylesheet" href="styles/assise-improvements.css">
    <link rel="stylesheet" href="styles/materials-extended.css">
    <link rel="stylesheet" href="styles/library-preview-3d.css">
    <link rel="stylesheet" href="styles/file-menu-dialogs.css">
    <link rel="stylesheet" href="styles/edit-menu-styles.css">
    <link rel="stylesheet" href="styles/presentation.css">
    <link rel="stylesheet" href="styles/startup-popup.css">
    <link rel="stylesheet" href="styles/metre-tab.css">
    <link rel="stylesheet" href="styles/layers-tab.css">
    <link rel="stylesheet" href="styles/tools-tab.css">
    <link rel="stylesheet" href="styles/reusable-elements.css">
    <link rel="stylesheet" href="styles/measurement-annotation-tools.css">
    <link rel="stylesheet" href="styles/properties-display.css">
    
    <!-- 5. Corrections finales (À CHARGER EN DERNIER) -->
    <link rel="stylesheet" href="styles/style-corrections.css">
    <link rel="stylesheet" href="styles/style-theme-enforcement.css">
    <link rel="stylesheet" href="styles/no-tabs-border.css">
    <link rel="stylesheet" href="styles/library-compact.css">
    <link rel="stylesheet" href="styles/library-visibility-system.css">
    
    <!-- 6. CORRECTIF UNIFORMISATION MENU - PRIORITÉ MAXIMALE -->
    <link rel="stylesheet" href="styles/menu-style-fix.css">
    
    <!-- 7. Validation développement (optionnel) -->
    <!-- <link rel="stylesheet" href="styles/style-validation.css"> -->
    
    <!-- FontAwesome LOCAL -->
    <link rel="stylesheet" href="lib/fontawesome/all.min.css">
    
    <!-- MIGRATION ES6 LOCAL - Three.js r179 modules purs locaux -->
    <script src="js/three-es6-direct.js"></script>
    
    <style>
        /* Masquage initial de l'interface principale pendant le chargement */
        body:not(.startup-loaded) #app,
        body:not(.startup-loaded) .toolbar,
        body:not(.startup-loaded) .instruction-message {
            opacity: 0;
            visibility: hidden;
            transform: scale(0.95);
            transition: opacity 0.8s ease, visibility 0.8s ease, transform 0.8s ease;
        }
        
        /* Affichage de l'interface une fois le startup terminé */
        body.startup-loaded #app,
        body.startup-loaded .toolbar,
        body.startup-loaded .instruction-message {
            opacity: 1;
            visibility: visible;
            transform: scale(1);
        }
        
        /* Animation d'apparition progressive pour différents éléments */
        body.startup-loaded .header {
            /* Animation supprimée pour éviter les décalages */
            /* animation: slideInFromTop 0.6s ease-out 0.2s both; */
            opacity: 1;
            transform: translateY(0) !important;
            position: relative !important;
            top: 0 !important;
        }
        
        body.startup-loaded .sidebar {
            animation: slideInFromRight 0.6s ease-out 0.4s both;
        }
        
        body.startup-loaded .viewport {
            animation: fadeInScale 0.8s ease-out 0.3s both;
        }
        
        body.startup-loaded .toolbar {
            animation: slideInFromLeft 0.6s ease-out 0.5s both;
        }
        
        /* Keyframes pour les animations */
        @keyframes slideInFromTop {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-30px) translateY(-50%);
            }
            to {
                opacity: 1;
                transform: translateX(0) translateY(-50%);
            }
        }
        
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.98);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Barre d'outils verticale */
        .toolbar {
            position: fixed;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 10px 5px;
            z-index: 10000;
            display: flex !important;
            flex-direction: column;
            gap: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* Conteneur pour tous les tooltips au survol */
        .toolbar-labels {
            position: fixed;
            left: 82px; /* Position exacte : 10px (left toolbar) + 60px (width) + 2px (border) + 10px (marge) */
            top: 50%;
            transform: translateY(-50%);
            z-index: 1500; /* Au-dessus des menus déroulants (z-index: 1001) mais pas trop haut */
            display: flex;
            flex-direction: column;
            gap: 10px; /* Même gap que la toolbar */
            pointer-events: none;
            padding: 10px 0; /* Même padding vertical que la toolbar pour l'alignement */
            
            /* Masqué par défaut */
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Afficher les labels au survol de la toolbar */
        .toolbar:hover ~ .toolbar-labels {
            opacity: 1;
            visibility: visible;
        }
        
        /* Style pour chaque label de commande */
        .toolbar-label {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            height: 50px; /* Même hauteur que les boutons */
            display: flex;
            align-items: center;
            
            /* Animation d'entrée */
            transform: translateX(-20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Séparateur invisible pour maintenir l'alignement */
        .toolbar-label.separator {
            height: 2px; /* Même hauteur que le séparateur de la toolbar */
            background: transparent;
            border: none;
            box-shadow: none;
            padding: 0;
            margin: 5px 0; /* Mêmes marges que le séparateur */
        }
        
        /* Animation décalée pour chaque label au survol */
        .toolbar:hover ~ .toolbar-labels .toolbar-label:nth-child(1) { 
            transition-delay: 0.05s;
            transform: translateX(0);
        }
        .toolbar:hover ~ .toolbar-labels .toolbar-label:nth-child(2) { 
            transition-delay: 0.1s;
            transform: translateX(0);
        }
        .toolbar:hover ~ .toolbar-labels .toolbar-label:nth-child(3) { 
            transition-delay: 0.15s;
            transform: translateX(0);
        }
        .toolbar:hover ~ .toolbar-labels .toolbar-label:nth-child(4) { 
            transition-delay: 0.2s;
            transform: translateX(0);
        }
        .toolbar:hover ~ .toolbar-labels .toolbar-label:nth-child(5) { 
            /* Séparateur - pas d'animation nécessaire */
            opacity: 0;
        }
        .toolbar:hover ~ .toolbar-labels .toolbar-label:nth-child(6) { 
            transition-delay: 0.25s;
            transform: translateX(0);
        }
        .toolbar:hover ~ .toolbar-labels .toolbar-label:nth-child(7) { 
            transition-delay: 0.3s;
            transform: translateX(0);
        }
        .toolbar:hover ~ .toolbar-labels .toolbar-label:nth-child(8) { 
            transition-delay: 0.35s;
            transform: translateX(0);
        }
        .toolbar:hover ~ .toolbar-labels .toolbar-label:nth-child(9) { 
            transition-delay: 0.4s;
            transform: translateX(0);
        }
        .toolbar:hover ~ .toolbar-labels .toolbar-label:nth-child(10) { 
            transition-delay: 0.45s;
            transform: translateX(0);
        }
        
        /* Petite flèche pointant vers la toolbar */
        .toolbar-label::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            border-right: 6px solid rgba(0, 0, 0, 0.9);
        }
        
        /* Pas de flèche pour le séparateur */
        .toolbar-label.separator::before {
            display: none;
        }
        
        /* Effet de survol global sur les labels */
        .toolbar:hover ~ .toolbar-labels .toolbar-label:not(.separator) {
            background: rgba(74, 144, 226, 0.9);
            border-color: #4a90e2;
            box-shadow: 0 2px 15px rgba(74, 144, 226, 0.4);
        }
        
        /* Styles pour les icônes FontAwesome */
        .tool-button i,
        .menu-icon i,
        .tab-icon i,
        .icon i {
            font-size: inherit;
            width: auto;
            height: auto;
        }

        /* Styles de boutons d'outils - conservés pour compatibilité */
        .tool-button {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            transition: all 0.3s ease;
            user-select: none;
        }
        
        .tool-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }
        
        .tool-button.active {
            background: rgba(74, 144, 226, 0.8);
            border-color: #4a90e2;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
        }
        
        .tool-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Message d'instruction */
        .instruction-message {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 1001;
            font-size: 14px;
            display: none;
        }

        /* Style pour l'information sur les joints verticaux fixes */
        .joint-info {
            display: block;
            font-size: 12px;
            color: #666;
            margin-top: 4px;
            font-style: italic;
            background: #f0f8ff;
            padding: 3px 6px;
            border-radius: 3px;
            border-left: 3px solid #4CAF50;
        }
        
        /* ===== CORRECTION FINALE HEADER MOBILE ===== */
        /* Priorité maximale avec !important pour forcer l'affichage correct */
        
        /* RESET GLOBAL ANTI-DÉCALAGE */
        * {
            box-sizing: border-box;
        }
        
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            position: relative !important;
            top: 0 !important;
            transform: none !important;
            overflow-x: hidden !important;
            height: 100% !important;
        }
        
        /* CORRECTIF ULTIME - EMPÊCHER TOUT DÉCALAGE VERS LE HAUT */
        html {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        body {
            position: relative !important;
            top: 0 !important;
            left: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            transform: translateY(0) !important;
        }
        
        /* HEADER TOUJOURS VISIBLE */
        .header {
            position: relative !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            margin: 0 !important;
            transform: none !important;
            z-index: 1000 !important;
            height: 60px !important;
        }
        
        /* MAIN-CONTENT CORRECT */
        .main-content {
            position: relative !important;
            top: 0 !important;
            margin: 0 !important;
            transform: none !important;
            height: calc(100vh - 60px) !important;
        }
        
        /* APP CONTAINER CORRECTION */
        #app {
            position: relative !important;
            top: 0 !important;
            left: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
            transform: none !important;
            width: 100% !important;
            height: 100vh !important;
        }
        
        @media (max-width: 768px) {
            body {
                overflow: hidden !important;
            }
            
            .header {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 10000 !important;
                height: 60px !important;
            }
            
            .main-content {
                height: calc(100vh - 60px) !important;
                margin-top: 60px !important;
                overflow: hidden !important;
            }
            
            .sidebar {
                position: fixed !important;
                top: 60px !important;
                right: -100% !important;
                height: calc(100vh - 60px) !important;
                width: 100% !important;
                z-index: 9999 !important;
                transition: right 0.3s ease !important;
            }
            
            .sidebar.open {
                right: 0 !important;
            }
            
            .viewport {
                height: calc(100vh - 60px) !important;
            }
        }
    </style>
    
    <script>
        // CORRECTIF JAVASCRIPT - FORCER LE REPOSITIONNEMENT CORRECT
        function forceLayoutCorrection() {
            // Forcer le repositionnement des éléments critiques
            document.documentElement.style.position = 'fixed';
            document.documentElement.style.top = '0';
            document.documentElement.style.left = '0';
            document.documentElement.style.right = '0';
            document.documentElement.style.bottom = '0';
            document.documentElement.style.margin = '0';
            document.documentElement.style.padding = '0';
            
            document.body.style.position = 'relative';
            document.body.style.top = '0';
            document.body.style.left = '0';
            document.body.style.margin = '0';
            document.body.style.padding = '0';
            document.body.style.width = '100vw';
            document.body.style.height = '100vh';
            document.body.style.transform = 'translateY(0)';
            
            const app = document.getElementById('app');
            if (app) {
                app.style.position = 'relative';
                app.style.top = '0';
                app.style.left = '0';
                app.style.margin = '0';
                app.style.padding = '0';
                app.style.transform = 'none';
                app.style.width = '100%';
                app.style.height = '100vh';
            }
            
            const header = document.querySelector('.header');
            if (header) {
                header.style.position = 'relative';
                header.style.top = '0';
                header.style.left = '0';
                header.style.right = '0';
                header.style.margin = '0';
                header.style.transform = 'none';
                header.style.zIndex = '1000';
                header.style.height = '60px';
            }
        }
        
        // Appliquer la correction dès que possible
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', forceLayoutCorrection);
        } else {
            forceLayoutCorrection();
        }
        
        // Réappliquer après resize
        window.addEventListener('resize', function() {
            setTimeout(forceLayoutCorrection, 100);
        });
        
        // Réappliquer périodiquement pour contrer les modifications JS
        setInterval(forceLayoutCorrection, 2000);
    </script>
    
    <style>
        /* CORRECTIF IMMÉDIAT MENU AFFICHAGE */
        #viewTop, #viewFront, #viewSide, #viewPerspective {
            display: flex !important;
            align-items: center !important;
            gap: 12px !important;
            padding: 10px 16px !important;
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
            color: var(--text-secondary) !important;
            font-size: 13px !important;
            font-weight: 400 !important;
            background: transparent !important;
            justify-content: flex-start !important;
        }
        
        #viewTop:hover, #viewFront:hover, #viewSide:hover, #viewPerspective:hover {
            background: rgba(0, 122, 204, 0.2) !important;
            color: var(--text-primary) !important;
        }
        
        #viewTop .menu-icon, #viewFront .menu-icon, #viewSide .menu-icon, #viewPerspective .menu-icon {
            font-size: 14px !important;
            width: 16px !important;
            text-align: center !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
    </style>
    
    <!-- Script pour forcer l'alignement à gauche des menus -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Force l'alignement à gauche de tous les menus dropdown
            function forceLeftAlignment() {
                document.querySelectorAll('.dropdown-menu, .submenu').forEach(menu => {
                    menu.style.left = '0px';
                    menu.style.right = 'auto';
                    menu.style.transform = 'none';
                    menu.style.marginLeft = '0px';
                    menu.style.marginRight = '0px';
                });
            }
            
            // Applique immédiatement
            forceLeftAlignment();
            
            // Réapplique toutes les 500ms pour contrer toute modification
            setInterval(forceLeftAlignment, 500);
            
            // Réapplique lors des interactions avec les menus
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('mouseenter', () => {
                    setTimeout(forceLeftAlignment, 10);
                });
                item.addEventListener('click', () => {
                    setTimeout(forceLeftAlignment, 10);
                });
            });
            
            console.log('🎯 Script d\'alignement des menus activé');
        });
    </script>
</head>
<body>
    <!-- Configuration de debug et logs -->
    <script>
        // Configuration globale des logs pour améliorer les performances
        window.DEBUG_CONSTRUCTION = false; // Désactiver les logs de construction excessifs
        window.VERBOSE_DPAD_LOGS = false; // Désactiver les logs répétitifs du D-pad
        window.VERBOSE_GLB_LOGS = false;  // Désactiver les logs GLB détaillés
        window.ENABLE_DELETE_ICON_POSITION_LOGS = false; // Désactiver les logs de position d'icône
        
        // Pour activer le debug en cas de besoin :
        // window.DEBUG_CONSTRUCTION = true;
        // window.VERBOSE_DPAD_LOGS = true;
        
        console.log('⚙️ Configuration des logs appliquée - Mode production activé');
    </script>
    
    <!-- Barre d'outils -->
    <div class="toolbar">
        <div class="tool-button" id="selectTool" title="Sélectionner">
            <i class="fas fa-mouse-pointer"></i>
        </div>
        <div class="tool-button" id="moveTool" title="Déplacer">
            <i class="fas fa-arrows-alt"></i>
        </div>
        <div class="tool-button" id="deleteTool" title="Supprimer">
            <i class="fas fa-trash"></i>
        </div>
        <div class="tool-button" id="duplicateTool" title="Dupliquer">
            <i class="fas fa-copy"></i>
        </div>
        <!-- Séparateur -->
        <div style="height: 2px; background: rgba(255,255,255,0.3); margin: 5px 0; border-radius: 1px;"></div>
        <!-- Outils de cotation et d'annotation -->
        <div class="tool-button" id="measureTool" title="Outil de mesure (M)">
            <i class="fas fa-ruler"></i>
            <span class="tool-counter" id="measureCounter" style="display: none;">0</span>
        </div>
        <div class="tool-button" id="annotationTool" title="Outil d'annotation (A)">
            <i class="fas fa-font"></i>
            <span class="tool-counter" id="annotationCounter" style="display: none;">0</span>
        </div>
        <div class="tool-button" id="textLeaderTool" title="Outil texte avec ligne de rappel (T)">
            <i class="fas fa-comment-dots"></i>
            <span class="tool-counter" id="textLeaderCounter" style="display: none;">0</span>
        </div>
        <div class="tool-button paint-mode-btn" id="materialPaintMode" title="Mode pinceau - Cliquez sur un matériau puis sur un élément pour le peindre">
            <i class="fas fa-paint-brush"></i>
        </div>
        
        <!-- Bouton d'aide générale supprimé - chaque outil a maintenant sa propre aide -->
    </div>
    
    <!-- Labels permanents pour la toolbar -->
    <div class="toolbar-labels" id="toolbarLabels">
        <div class="toolbar-label">Sélectionner</div>
        <div class="toolbar-label">Déplacer</div>
        <div class="toolbar-label">Supprimer</div>
        <div class="toolbar-label">Dupliquer</div>
        <div class="toolbar-label separator"></div>
        <div class="toolbar-label">Outil de mesure (M)</div>
        <div class="toolbar-label">Outil d'annotation (A)</div>
        <div class="toolbar-label">Texte avec ligne de rappel (T)</div>
        <div class="toolbar-label">Mode pinceau</div>
    </div>
    
    <!-- Message d'instruction -->
    <div class="instruction-message" id="instructionMessage"></div>
    
    <!-- Panneau de contrôle des textes avec ligne de rappel -->
<div class="text-leader-controls" id="textLeaderControls">
    <h3><i class="fas fa-comment-dots"></i> Textes avec Ligne de Rappel</h3>
    <div class="text-leader-filter">
        <label for="textLeaderStyleFilter">Filtrer par style:</label>
        <select id="textLeaderStyleFilter">
            <option value="">Tous les styles</option>
            <option value="normal">Normal</option>
            <option value="bold">Gras</option>
            <option value="italic">Italique</option>
            <option value="title">Titre</option>
        </select>
        <label for="textLeaderColorFilter">Filtrer par couleur:</label>
        <select id="textLeaderColorFilter">
            <option value="">Toutes les couleurs</option>
            <option value="black">Noir</option>
            <option value="blue">Bleu</option>
            <option value="red">Rouge</option>
            <option value="green">Vert</option>
            <option value="orange">Orange</option>
            <option value="purple">Violet</option>
        </select>
        <label for="textLeaderSearch">Rechercher:</label>
        <input type="text" id="textLeaderSearch" placeholder="Rechercher dans le texte...">
    </div>
    <div class="text-leader-actions">
        <button class="text-leader-btn-action text-leader-btn-clear" id="clearTextLeaders">Effacer tout</button>
        <button class="text-leader-btn-action text-leader-btn-export" id="exportTextLeaders">Exporter</button>
        <button class="text-leader-btn-action text-leader-btn-hide" id="hideTextLeaders">Masquer</button>
    </div>
    <div class="text-leader-list" id="textLeaderList"></div>
</div>    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="logo">
                        <span class="logo-text">WallSim3D</span>
                        <span class="logo-version">v1.0</span>
                    </h1>
                    
                    <!-- Menu Bar -->
                    <nav class="menu-bar">
                    <div class="menu-item" data-menu="file">
                        <span>Fichier</span>
                        <div class="dropdown-menu">
                            <div class="menu-option" id="newProject">
                                <span class="menu-icon"><i class="fas fa-file"></i></span>
                                Nouveau Projet
                                <span class="shortcut">Ctrl+N</span>
                            </div>
                            <div class="menu-option" id="openProject">
                                <span class="menu-icon"><i class="fas fa-folder-open"></i></span>
                                Ouvrir...
                                <span class="shortcut">Ctrl+O</span>
                            </div>
                            <div class="menu-option" id="saveProject">
                                <span class="menu-icon"><i class="fas fa-save"></i></span>
                                Sauvegarder
                                <span class="shortcut">Ctrl+S</span>
                            </div>
                            <div class="menu-option" id="saveAsProject">
                                <span class="menu-icon"><i class="fas fa-save"></i></span>
                                Sauvegarder sous...
                                <span class="shortcut">Ctrl+Shift+S</span>
                            </div>
                            <div class="menu-separator"></div>
                            <div class="menu-option" id="exportProject">
                                <span class="menu-icon"><i class="fas fa-upload"></i></span>
                                Exporter
                            </div>
                            <div class="menu-option" id="importProject">
                                <span class="menu-icon"><i class="fas fa-download"></i></span>
                                Importer
                            </div>

                        </div>
                    </div>
                    
                    <div class="menu-item" data-menu="edit">
                        <span>Edition</span>
                        <div class="dropdown-menu">
                            <div class="menu-option" id="undoAction">
                                <span class="menu-icon"><i class="fas fa-undo"></i></span>
                                Annuler
                                <span class="shortcut">Ctrl+Z</span>
                            </div>
                            <div class="menu-option" id="redoAction">
                                <span class="menu-icon"><i class="fas fa-redo"></i></span>
                                Rétablir
                                <span class="shortcut">Ctrl+Y</span>
                            </div>
                            <div class="menu-separator"></div>
                            <div class="menu-option" id="copyAction">
                                <span class="menu-icon"><i class="fas fa-copy"></i></span>
                                Copier
                                <span class="shortcut">Ctrl+C</span>
                            </div>
                            <div class="menu-option" id="pasteAction">
                                <span class="menu-icon"><i class="fas fa-paste"></i></span>
                                Coller
                                <span class="shortcut">Ctrl+V</span>
                            </div>
                            <div class="menu-option" id="deleteAction">
                                <span class="menu-icon"><i class="fas fa-trash"></i></span>
                                Supprimer
                                <span class="shortcut">Delete</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="menu-item" data-menu="view">
                        <span>Affichage</span>
                        <div class="dropdown-menu">
                            <div class="menu-option" id="viewTop">
                                <span class="menu-icon"><i class="fas fa-arrow-up"></i></span>
                                Vue de dessus
                            </div>
                            <div class="menu-option" id="viewFront">
                                <span class="menu-icon"><i class="fas fa-arrow-right"></i></span>
                                Vue de face
                            </div>
                            <div class="menu-option" id="viewSide">
                                <span class="menu-icon"><i class="fas fa-arrow-alt-circle-up"></i></span>
                                Vue de côté
                            </div>
                            <div class="menu-option" id="viewPerspective">
                                <span class="menu-icon"><i class="fas fa-eye"></i></span>
                                Vue perspective
                            </div>
                        </div>
                    </div>
                    
                    <div class="menu-item" data-menu="help">
                        <span>Aide</span>
                        <div class="dropdown-menu">
                            <div class="menu-option" id="aboutApp">
                                <span class="menu-icon"><i class="fas fa-info-circle"></i></span>
                                À propos
                            </div>
                        </div>
                    </div>
                </nav>
                </div>
                
                <div class="header-right">
                    <!-- Bouton Présenter -->
                    <div class="presentation-button">
                        <button class="present-btn" id="presentBtn" data-tooltip="Exporter en présentation PDF">
                            <span class="btn-icon"><i class="fas fa-file-pdf"></i></span>
                            Présenter
                        </button>
                    </div>
                    
                    <!-- Time Display -->
                    <div class="time-display">
                        <div class="current-time" id="currentTime"></div>
                        <div class="current-date" id="currentDate"></div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- 3D Viewport -->
            <main class="viewport">
                <div id="scene-container">
                    <canvas id="threejs-canvas"></canvas>
                </div>
                
                <!-- Viewport Controls -->
                <div class="viewport-controls">
                    <div class="view-controls">
                        <button class="view-btn active" data-view="perspective">3D</button>
                        <button class="view-btn" data-view="top">Dessus</button>
                        <button class="view-btn" data-view="front">Avant</button>
                        <button class="view-btn" data-view="side">Côté</button>
                    </div>
                    
                    <div class="zoom-controls">
                        <button class="zoom-btn" id="zoomIn">+</button>
                        <button class="zoom-btn" id="zoomOut">-</button>
                        <button class="zoom-btn" id="zoomFit">⌘</button>
                    </div>
                    
                    <div class="grid-controls">
                        <button class="grid-btn" id="toggleGrid">Grille</button>
                        <button class="grid-btn" id="toggleAxes">Axes</button>
                    </div>
                </div>
                
                <!-- Indicateurs d'édition -->
                <div class="selection-status" id="selectionStatus"></div>
                <div class="clipboard-indicator" id="clipboardIndicator"></div>
                
                <!-- Historique Annuler/Rétablir -->
                <div class="undo-redo-history" id="undoRedoHistory">
                    <h4><i class="fas fa-history"></i> Historique</h4>
                    <div class="history-list" id="historyList"></div>
                </div>

                <!-- Bottom Panel -->
                <div class="bottom-panel">
                    <div class="status-bar">
                        <div class="status-section">
                            <span class="status-label">Position:</span>
                            <span id="mousePosition">X: 0, Y: 0, Z: 0</span>
                        </div>
                        <div class="status-section">
                            <span class="status-label">Curseur:</span>
                            <span>X: <span id="cursorX">0</span>, Z: <span id="cursorZ">0</span></span>
                        </div>
                        <div class="status-section">
                            <span class="status-label">Mode:</span>
                            <span id="currentMode">Brique</span>
                        </div>
                        <div class="status-section">
                            <span class="status-label">Matériau:</span>
                            <span id="currentMaterial">Brique Rouge</span>
                        </div>
                        <div class="status-section">
                            <span class="status-label">Rotation:</span>
                            <span id="currentRotation">0°</span>
                        </div>
                        <div class="status-section">
                            <span class="status-label">Orientation:</span>
                            <span id="currentOrientation">Panneresse</span>
                        </div>
                        <div class="status-section">
                            <span class="status-label">Caméra:</span>
                            <span id="cameraPosition">Vue perspective</span>
                        </div>
                        <div class="status-section">
                            <span class="status-label">Three.js:</span>
                            <span id="threejsVersion">-</span>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Sidebar -->
            <aside class="sidebar">
                
                <!-- Onglets principaux -->
                    <div class="main-tabs">
                        <!-- Première ligne d'onglets -->
                        <div class="tabs-row">
                            <button class="main-tab active" data-tab="biblio">
                                <span class="tab-icon"><i class="fas fa-book"></i></span>
                                Biblio
                            </button>
                            <button class="main-tab" data-tab="assise">
                                <span class="tab-icon"><i class="fas fa-layer-group"></i></span>
                                Assise
                            </button>
                            <button class="main-tab" data-tab="textures">
                                <span class="tab-icon"><i class="fas fa-palette"></i></span>
                                Textures
                            </button>
                            <button class="main-tab" data-tab="joints">
                                <span class="tab-icon"><i class="fas fa-project-diagram"></i></span>
                                Joints
                            </button>
                        </div>
                        
                        <!-- Deuxième ligne d'onglets -->
                        <div class="tabs-row">
                            <button class="main-tab" data-tab="proprietes">
                                <span class="tab-icon"><i class="fas fa-cog"></i></span>
                                Propriétés
                            </button>
                            <button class="main-tab" data-tab="preferences">
                                <span class="tab-icon"><i class="fas fa-tools"></i></span>
                                Préférences
                            </button>
                            <button class="main-tab" data-tab="ombres">
                                <span class="tab-icon"><i class="fas fa-cloud"></i></span>
                                Ombres
                            </button>
                            <button class="main-tab" data-tab="metre">
                                <span class="tab-icon"><i class="fas fa-table"></i></span>
                                Métré
                            </button>
                        </div>

                        <!-- Troisième ligne d'onglets -->
                        <div class="tabs-row">
                            <button class="main-tab" data-tab="projet">
                                <span class="tab-icon"><i class="fas fa-clipboard"></i></span>
                                Projet
                            </button>
                            <button class="main-tab" data-tab="calques">
                                <span class="tab-icon"><i class="fas fa-layer-group"></i></span>
                                Calques
                            </button>
                            <button class="main-tab" data-tab="mode-operatoire">
                                <span class="tab-icon"><i class="fas fa-list-ol"></i></span>
                                Mode opératoire
                            </button>
                        </div>
                    </div>

                    <!-- Contenu onglet Assise -->
                    <div id="tab-content-assise" class="tab-content">>
                        <!-- Indicateur de bloc sélectionné -->
                        <div class="selected-block-info" style="display: none;">
                            <div class="info-header">
                                <span class="icon"><i class="fas fa-cube"></i></span>
                                <span>Bloc sélectionné</span>
                            </div>
                            <div id="currentBlockDisplay" class="block-display">
                                <div class="block-name">Bloc creux B9</div>
                                <div class="block-dimensions">39×9×19 cm</div>
                                <div class="block-type">Entier</div>
                            </div>
                        </div>

                        <!-- Indicateur d'isolant sélectionné -->
                        <div class="selected-insulation-info" style="display: none;">
                            <div class="info-header">
                                <span class="icon"><i class="fas fa-th-large"></i></span>
                                <span>Isolant sélectionné</span>
                            </div>
                            <div id="currentInsulationDisplay" class="insulation-display">
                                <div class="insulation-name">Isolant PUR5</div>
                                <div class="insulation-dimensions">120×5×60 cm</div>
                                <div class="insulation-type">Standard</div>
                            </div>
                        </div>

                        <!-- Indicateur de linteau sélectionné -->
                        <div class="selected-linteau-info" style="display: none;">
                            <div class="info-header">
                                <span class="icon">🏗️</span>
                                <span>Linteau sélectionné</span>
                            </div>
                            <div id="currentLinteauDisplay" class="linteau-display">
                                <div class="linteau-name">Linteau Béton L120</div>
                                <div class="linteau-dimensions">120×14×19 cm</div>
                                <div class="linteau-type">Standard</div>
                            </div>
                        </div>

                        <!-- Vue d'ensemble globale des assises -->
                        <div class="tool-section">
                            <h4><i class="fas fa-chart-bar"></i> Vue d'ensemble des Assises</h4>
                            <div class="assise-global-overview">
                                <div class="overview-stats">
                                    <div class="stat-item">
                                        <span class="stat-label">Total Assises:</span>
                                        <span class="stat-value" id="totalAssisesCount">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Total Éléments:</span>
                                        <span class="stat-value" id="totalElementsCount">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Hauteur Totale:</span>
                                        <span class="stat-value" id="totalHeightValue">0.0 cm</span>
                                    </div>
                                </div>
                                
                                <!-- Liste des assises remplies uniquement (contenant des éléments) -->
                                <div class="assise-global-list">
                                    <div class="list-header">
                                        <span class="header-icon"><i class="fas fa-clipboard-list"></i></span>
                                        <span class="header-title">Assises Remplies</span>
                                        <button id="toggleGlobalList" class="btn btn-xs btn-secondary">Masquer</button>
                                    </div>
                                    <div class="list-content" id="globalAssiseList">
                                        <!-- Contenu généré dynamiquement - ne montre que les assises avec des éléments -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tool-section">
                            <h4><i class="fas fa-wrench"></i> Gestion des Assises</h4>
                            
                            <!-- Informations du type actuel -->
                            <div class="current-type-info">
                                <div class="type-badge-display">
                                    <span class="type-badge" id="currentTypeBadge">M65</span>
                                    <span class="type-description" id="currentTypeDescription">Briques 6.5cm - Assise active</span>
                                </div>
                            </div>
                            
                            <div class="assise-controls">
                                <div class="control-group">
                                    <label for="jointHeight">Hauteur joint (cm):</label>
                                    <input type="number" id="jointHeight" min="0.1" max="5" step="0.1" value="1.2">
                                </div>
                                
                                <div class="button-group">
                                    <button id="addAssise" class="btn btn-sm btn-primary"><i class="fas fa-plus"></i> Ajouter Assise</button>
                                    <button id="removeAssise" class="btn btn-sm btn-warning"><i class="fas fa-trash"></i> Supprimer</button>
                                </div>
                                
                                <div class="control-group">
                                    <button id="toggleAssiseGrids" class="btn btn-sm btn-secondary"><i class="fas fa-eye"></i> Grilles</button>
                                    <button id="toggleAttachmentMarkers" class="btn btn-sm btn-info"><i class="fas fa-map-pin"></i> Marqueurs</button>
                                </div>
                                
                                <div class="info-group">
                                    <div class="assise-details" id="currentAssiseDetails">
                                        <span class="detail-label">Assise:</span>
                                        <span class="detail-value" id="assiseCount">M65: 1 assise</span>
                                    </div>
                                    <div class="assise-details" id="activeAssiseInfo">
                                        <span class="detail-label">État:</span>
                                        <span class="detail-value">Assise active: vide</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sélecteur de type de brique pour assises indépendantes -->
                        <div class="tool-section">
                            <h4><i class="fas fa-th"></i> Type de Brique Assise</h4>
                            <div class="brick-type-selector">
                                <div class="brick-type-info">
                                    <span class="type-indicator" id="brickTypeIndicator">
                                        <span class="type-badge">M65</span>
                                        <span class="type-description">Hauteur: 6.5 cm</span>
                                    </span>
                                </div>
                                <div class="info-group">
                                    <small id="currentTypeInfo">Type actif: M65 - Toutes les nouvelles assises utiliseront ce type</small>
                                </div>
                            </div>
                        </div>

                        <!-- Section Aides Visuelles -->
                        <div class="tool-section">
                            <h4><i class="fas fa-eye"></i> Aides Visuelles</h4>
                            
                            <div class="visual-aids-checkboxes">
                                <div class="checkbox-group">
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="toggleGridsTab" checked="">
                                        <span class="checkmark"></span>
                                        <i class="fas fa-th"></i> Grilles
                                    </label>
                                </div>
                                
                                <div class="checkbox-group">
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="toggleMarkersTab" checked="">
                                        <span class="checkmark"></span>
                                        <i class="fas fa-map-pin"></i> Points d'Accroche
                                    </label>
                                </div>
                                
                                <div class="checkbox-group">
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="toggleSnapPointTab">
                                        <span class="checkmark"></span>
                                        <i class="fas fa-crosshairs"></i> Point de Suivi
                                    </label>
                                </div>
                                
                                <div class="checkbox-group">
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="toggleUsedElementsFrameTab">
                                        <span class="checkmark"></span>
                                        <i class="fas fa-border-all"></i> Encadrer Éléments Utilisés
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contenu onglet Biblio -->
                    <div id="tab-content-biblio" class="tab-content active">
                        <!-- Indicateur de brique sélectionnée -->
                        <div class="selected-brick-info" style="display: block;">
                            <div class="info-header">
                                <span class="icon"><i class="fas fa-ruler"></i></span>
                                <span>Brique sélectionnée</span>
                            </div>
                            <div id="currentBrickDisplay" class="brick-display">
                                <div class="brick-name">Brique M65</div>
                                <div class="brick-dimensions">19×6.5×9 cm</div>
                                <div class="brick-type">Entière</div>
                            </div>
                        </div>
                        
                        <div class="tool-section">
                            <h4>Bibliothèque d'Éléments</h4>
                            
                            <!-- Sous-onglets principaux pour la bibliothèque -->
                            <div class="main-sub-tabs">
                                <button class="main-sub-tab active" data-main-subtab="bibliotheque">
                                    <i class="fas fa-th-large"></i> Bibliothèque
                                </button>
                                <button class="main-sub-tab" data-main-subtab="reutiliser">
                                    <i class="fas fa-recycle"></i> Éléments à réutiliser
                                </button>
                            </div>
                            
                            <!-- Contenu Bibliothèque -->
                            <div id="main-subtab-bibliotheque" class="main-subtab-content active">
                                <!-- Sous-onglets pour la bibliothèque -->
                                <div class="sub-tabs">
                                    <button class="sub-tab active" data-subtab="briques">Briques</button>
                                    <button class="sub-tab" data-subtab="blocs">Blocs</button>
                                    <button class="sub-tab" data-subtab="isolants">Isolants</button>
                                    <button class="sub-tab" data-subtab="linteaux">Linteaux</button>
                                    <button class="sub-tab" data-subtab="outils">Outils</button>
                                    <button class="sub-tab" data-subtab="planchers">Planchers</button>
                                    <button class="sub-tab" data-subtab="poutres">Poutres</button>
                                </div>

                            <!-- Contenu bibliothèque briques -->
                            <div id="subtab-briques" class="subtab-content active">
                                <div class="library-section">
                                    <h5><i class="fas fa-th"></i> Types de Briques</h5>
                                    <div class="library-grid">
                                        <div class="library-item active" data-type="M65">
                                            <div class="item-preview">
                                                <canvas class="preview-3d" width="360" height="280" data-brick-type="M65"></canvas>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">M65</div>
                                                <div class="item-dimensions">19×6.5×9 cm</div>
                                            </div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini active" data-cut="1/1" data-base-type="M65">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="M65">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="M65">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="M65">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="M65">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="M50">
                                            <div class="item-preview">
                                                <canvas class="preview-3d" width="360" height="280" data-brick-type="M50"></canvas>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">M50</div>
                                                <div class="item-dimensions">19×5×9 cm</div>
                                            </div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="M50">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="M50">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="M50">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="M50">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="M50">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="M57">
                                            <div class="item-preview">
                                                <canvas class="preview-3d" width="360" height="280" data-brick-type="M57"></canvas>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">M57</div>
                                                <div class="item-dimensions">19×5.7×9 cm</div>
                                            </div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="M57">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="M57">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="M57">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="M57">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="M57">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="M60">
                                            <div class="item-preview">
                                                <canvas class="preview-3d" width="360" height="280" data-brick-type="M60"></canvas>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">M60</div>
                                                <div class="item-dimensions">19×6×9 cm</div>
                                            </div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="M60">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="M60">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="M60">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="M60">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="M60">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="M90">
                                            <div class="item-preview">
                                                <canvas class="preview-3d" width="360" height="280" data-brick-type="M90"></canvas>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">M90</div>
                                                <div class="item-dimensions">19×9×9 cm</div>
                                            </div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="M90">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="M90">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="M90">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="M90">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="M90">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="M50_CHANT">
                                            <div class="item-preview">
                                                <canvas class="preview-3d" width="360" height="280" data-brick-type="M50_CHANT"></canvas>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">M50 sur chant</div>
                                                <div class="item-dimensions">5×19×9 cm</div>
                                            </div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="M50_CHANT">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="M50_CHANT">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="M50_CHANT">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="M50_CHANT">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="M50_CHANT">P</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- BOUTON TEST TEMPORAIRE -->
                                    <div style="padding: 20px; border: 2px solid red; margin: 10px;">
                                        <h5 style="color: red;">🧪 TESTS HAUTEUR (temporaire)</h5>
                                        <button onclick="testHeightPanel()" style="margin: 5px; padding: 10px; background: green; color: white;">Tester Panneau</button>
                                        <button onclick="testM50Selection()" style="margin: 5px; padding: 10px; background: blue; color: white;">Sélectionner M50_CHANT</button>
                                        <button onclick="testBrickSelector()" style="margin: 5px; padding: 10px; background: orange; color: white;">Test BrickSelector</button>
                                    </div>

                                </div>
                            </div>

                            <!-- Contenu bibliothèque blocs -->
                            <div id="subtab-blocs" class="subtab-content">
                                <div class="library-section">
                                    <h5>🏗️ Blocs Creux (Béton)</h5>
                                    <small class="section-description">Structure traditionnelle, à enduire - λ=1.35 - 39×19 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="B9">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">B9</div>
                                            <div class="item-dimensions">39×9×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="B9">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="B9">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="B9">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="B9">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="B9">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="B14">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">B14</div>
                                            <div class="item-dimensions">39×14×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="B14">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="B14">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="B14">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="B14">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="B14">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="B19">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">B19</div>
                                            <div class="item-dimensions">39×19×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="B19">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="B19">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="B19">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="B19">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="B19">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="B29">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">B29</div>
                                            <div class="item-dimensions">39×29×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="B29">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="B29">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="B29">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="B29">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="B29">P</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h5>⬜ Blocs Béton Cellulaire</h5>
                                    <small class="section-description">Légers et isolants, facilité de pose - λ=0.15 - 60×25 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="BC_60x5">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">BC 60x5</div>
                                            <div class="item-dimensions">60×5×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BC_60x5">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BC_60x5">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BC_60x5">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BC_60x5">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BC_60x5">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BC_60x7">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">BC 60x7</div>
                                            <div class="item-dimensions">60×7×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BC_60x7">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BC_60x7">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BC_60x7">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BC_60x7">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BC_60x7">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BC_60x10">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">BC 60x10</div>
                                            <div class="item-dimensions">60×10×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BC_60x10">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BC_60x10">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BC_60x10">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BC_60x10">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BC_60x10">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BC_60x15">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">BC 60x15</div>
                                            <div class="item-dimensions">60×15×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BC_60x15">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BC_60x15">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BC_60x15">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BC_60x15">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BC_60x15">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BC_60x17">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">BC 60x17.5</div>
                                            <div class="item-dimensions">60×17.5×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BC_60x17">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BC_60x17">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BC_60x17">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BC_60x17">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BC_60x17">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BC_60x20">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">BC 60x20</div>
                                            <div class="item-dimensions">60×20×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BC_60x20">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BC_60x20">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BC_60x20">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BC_60x20">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BC_60x20">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BC_60x24">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">BC 60x24</div>
                                            <div class="item-dimensions">60×24×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BC_60x24">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BC_60x24">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BC_60x24">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BC_60x24">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BC_60x24">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BC_60x30">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">BC 60x30</div>
                                            <div class="item-dimensions">60×30×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BC_60x30">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BC_60x30">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BC_60x30">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BC_60x30">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BC_60x30">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BC_60x36">
                                            <div class="item-icon">⬜</div>
                                            <div class="item-name">BC 60x36</div>
                                            <div class="item-dimensions">60×36×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BC_60x36">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BC_60x36">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BC_60x36">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BC_60x36">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BC_60x36">P</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h5>🔘 Blocs Argex (Granulats légers)</h5>
                                    <small class="section-description">Granulats d'argile expansée isolants - λ=0.28 - 39×19 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="ARGEX_39x9">
                                            <div class="item-icon">🟫</div>
                                            <div class="item-name">Argex 39x9</div>
                                            <div class="item-dimensions">39×9×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="ARGEX_39x9">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="ARGEX_39x9">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="ARGEX_39x9">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="ARGEX_39x9">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="ARGEX_39x9">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="ARGEX_39x14">
                                            <div class="item-icon">🟫</div>
                                            <div class="item-name">Argex 39x14</div>
                                            <div class="item-dimensions">39×14×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="ARGEX_39x14">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="ARGEX_39x14">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="ARGEX_39x14">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="ARGEX_39x14">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="ARGEX_39x14">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="ARGEX_39x19">
                                            <div class="item-icon">🟫</div>
                                            <div class="item-name">Argex 39x19</div>
                                            <div class="item-dimensions">39×19×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="ARGEX_39x19">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="ARGEX_39x19">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="ARGEX_39x19">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="ARGEX_39x19">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="ARGEX_39x19">P</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h5>🔷 Blocs Béton Cellulaire Assise</h5>
                                    <small class="section-description">Spécial assises, hauteur réduite - λ=0.15 - 60×20-25 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="BCA_60x9x20">
                                            <div class="item-icon">🔷</div>
                                            <div class="item-name">BCA 60x9x20</div>
                                            <div class="item-dimensions">60×9×20 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BCA_60x9x20">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BCA_60x9x20">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BCA_60x9x20">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BCA_60x9x20">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BCA_60x9x20">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BCA_60x14x20">
                                            <div class="item-icon">🔷</div>
                                            <div class="item-name">BCA 60x14x20</div>
                                            <div class="item-dimensions">60×14×20 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BCA_60x14x20">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BCA_60x14x20">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BCA_60x14x20">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BCA_60x14x20">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BCA_60x14x20">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BCA_60x19x20">
                                            <div class="item-icon">🔷</div>
                                            <div class="item-name">BCA 60x19x20</div>
                                            <div class="item-dimensions">60×19×20 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BCA_60x19x20">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BCA_60x19x20">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BCA_60x19x20">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BCA_60x19x20">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BCA_60x19x20">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BCA_60x9x25">
                                            <div class="item-icon">🔷</div>
                                            <div class="item-name">BCA 60x9x25</div>
                                            <div class="item-dimensions">60×9×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BCA_60x9x25">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BCA_60x9x25">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BCA_60x9x25">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BCA_60x9x25">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BCA_60x9x25">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BCA_60x14x25">
                                            <div class="item-icon">🔷</div>
                                            <div class="item-name">BCA 60x14x25</div>
                                            <div class="item-dimensions">60×14×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BCA_60x14x25">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BCA_60x14x25">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BCA_60x14x25">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BCA_60x14x25">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BCA_60x14x25">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="BCA_60x19x25">
                                            <div class="item-icon">🔷</div>
                                            <div class="item-name">BCA 60x19x25</div>
                                            <div class="item-dimensions">60×19×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="BCA_60x19x25">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="BCA_60x19x25">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="BCA_60x19x25">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="BCA_60x19x25">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="BCA_60x19x25">P</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h5>🟤 Blocs Terre Cuite</h5>
                                    <small class="section-description">Matériau traditionnel et durable - λ=0.35 - 50×25 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="TC_50x10">
                                            <div class="item-icon">🟤</div>
                                            <div class="item-name">TC 50x10</div>
                                            <div class="item-dimensions">50×10×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="TC_50x10">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="TC_50x10">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="TC_50x10">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="TC_50x10">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="TC_50x10">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="TC_50x14">
                                            <div class="item-icon">🟤</div>
                                            <div class="item-name">TC 50x14</div>
                                            <div class="item-dimensions">50×14×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="TC_50x14">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="TC_50x14">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="TC_50x14">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="TC_50x14">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="TC_50x14">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="TC_50x19">
                                            <div class="item-icon">🟤</div>
                                            <div class="item-name">TC 50x19</div>
                                            <div class="item-dimensions">50×19×25 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="TC_50x19">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="TC_50x19">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="TC_50x19">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="TC_50x19">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="TC_50x19">P</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Contenu bibliothèque isolants -->
                            <div id="subtab-isolants" class="subtab-content">
                                <div class="library-section">
                                    <h5>🔶 Panneaux PUR (Polyuréthane)</h5>
                                    <small class="section-description">Hautes performances thermiques, faible épaisseur - λ=0.025 - 120×60 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="PUR5">
                                            <div class="item-icon">🟡</div>
                                            <div class="item-name">PUR5</div>
                                            <div class="item-dimensions">120×5×60 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="PUR5">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="PUR5">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="PUR5">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="PUR5">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="PUR5">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="PUR6">
                                            <div class="item-icon">🟡</div>
                                            <div class="item-name">PUR6</div>
                                            <div class="item-dimensions">120×6×60 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="PUR6">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="PUR6">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="PUR6">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="PUR6">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="PUR6">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="PUR7">
                                            <div class="item-icon">🟡</div>
                                            <div class="item-name">PUR7</div>
                                            <div class="item-dimensions">120×7×60 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="PUR7">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="PUR7">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="PUR7">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="PUR7">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="PUR7">P</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h5>🧽 Panneaux Laine de Roche (Classique)</h5>
                                    <small class="section-description">Isolation thermique et phonique, résistant au feu - λ=0.040 - 120×60 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="LAINEROCHE5">
                                            <div class="item-icon">🧽</div>
                                            <div class="item-name">LR5</div>
                                            <div class="item-dimensions">120×5×60 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="LAINEROCHE5">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="LAINEROCHE5">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="LAINEROCHE5">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="LAINEROCHE5">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="LAINEROCHE5">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="LAINEROCHE6">
                                            <div class="item-icon">🧽</div>
                                            <div class="item-name">LR6</div>
                                            <div class="item-dimensions">120×6×60 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="LAINEROCHE6">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="LAINEROCHE6">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="LAINEROCHE6">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="LAINEROCHE6">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="LAINEROCHE6">P</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h5>🔵 Panneaux XPS (Zones humides)</h5>
                                    <small class="section-description">Résistant à l'humidité, sols et soubassements - λ=0.034 - 125×60 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="XPS20">
                                            <div class="item-icon">🔵</div>
                                            <div class="item-name">XPS20</div>
                                            <div class="item-dimensions">125×20×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="XPS20">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="XPS20">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="XPS20">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="XPS20">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="XPS20">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="XPS30">
                                            <div class="item-icon">🔵</div>
                                            <div class="item-name">XPS30</div>
                                            <div class="item-dimensions">125×30×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="XPS30">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="XPS30">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="XPS30">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="XPS30">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="XPS30">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="XPS40">
                                            <div class="item-icon">🔵</div>
                                            <div class="item-name">XPS40</div>
                                            <div class="item-dimensions">125×40×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="XPS40">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="XPS40">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="XPS40">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="XPS40">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="XPS40">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="XPS50">
                                            <div class="item-icon">🔵</div>
                                            <div class="item-name">XPS50</div>
                                            <div class="item-dimensions">125×50×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="XPS50">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="XPS50">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="XPS50">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="XPS50">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="XPS50">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="XPS60">
                                            <div class="item-icon">🔵</div>
                                            <div class="item-name">XPS60</div>
                                            <div class="item-dimensions">125×60×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="XPS60">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="XPS60">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="XPS60">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="XPS60">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="XPS60">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="XPS80">
                                            <div class="item-icon">🔵</div>
                                            <div class="item-name">XPS80</div>
                                            <div class="item-dimensions">125×80×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="XPS80">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="XPS80">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="XPS80">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="XPS80">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="XPS80">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="XPS100">
                                            <div class="item-icon">🔵</div>
                                            <div class="item-name">XPS100</div>
                                            <div class="item-dimensions">125×100×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="XPS100">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="XPS100">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="XPS100">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="XPS100">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="XPS100">P</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Nouvelle section PSE -->
                                <div class="library-section">
                                    <h5>🔹 Panneaux PSE (Économiques)</h5>
                                    <small class="section-description">Solution économique pour façades - λ=0.038 - 100×50 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="PSE20">
                                            <div class="item-icon">⚪</div>
                                            <div class="item-name">PSE20</div>
                                            <div class="item-dimensions">100×20×50 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="PSE20">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="PSE20">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="PSE20">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="PSE20">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="PSE20">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="PSE40">
                                            <div class="item-icon">⚪</div>
                                            <div class="item-name">PSE40</div>
                                            <div class="item-dimensions">100×40×50 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="PSE40">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="PSE40">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="PSE40">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="PSE40">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="PSE40">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="PSE60">
                                            <div class="item-icon">⚪</div>
                                            <div class="item-name">PSE60</div>
                                            <div class="item-dimensions">100×60×50 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="PSE60">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="PSE60">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="PSE60">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="PSE60">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="PSE60">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="PSE100">
                                            <div class="item-icon">⚪</div>
                                            <div class="item-name">PSE100</div>
                                            <div class="item-dimensions">100×100×50 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="PSE100">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="PSE100">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="PSE100">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="PSE100">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="PSE100">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="PSE160">
                                            <div class="item-icon">⚪</div>
                                            <div class="item-name">PSE160</div>
                                            <div class="item-dimensions">100×160×50 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="PSE160">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="PSE160">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="PSE160">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="PSE160">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="PSE160">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="PSE200">
                                            <div class="item-icon">⚪</div>
                                            <div class="item-name">PSE200</div>
                                            <div class="item-dimensions">100×200×50 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="PSE200">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="PSE200">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="PSE200">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="PSE200">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="PSE200">P</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Nouvelle section Fibre de Bois -->
                                <div class="library-section">
                                    <h5>🌿 Panneaux Fibre de Bois (Écologiques)</h5>
                                    <small class="section-description">Choix écologique, confort d'été - λ=0.042 - 135×57.5 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="FB40">
                                            <div class="item-icon">🟡</div>
                                            <div class="item-name">FB40</div>
                                            <div class="item-dimensions">135×40×57.5 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="FB40">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="FB40">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="FB40">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="FB40">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="FB40">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="FB60">
                                            <div class="item-icon">🟡</div>
                                            <div class="item-name">FB60</div>
                                            <div class="item-dimensions">135×60×57.5 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="FB60">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="FB60">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="FB60">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="FB60">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="FB60">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="FB100">
                                            <div class="item-icon">🟡</div>
                                            <div class="item-name">FB100</div>
                                            <div class="item-dimensions">135×100×57.5 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="FB100">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="FB100">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="FB100">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="FB100">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="FB100">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="FB140">
                                            <div class="item-icon">🟡</div>
                                            <div class="item-name">FB140</div>
                                            <div class="item-dimensions">135×140×57.5 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="FB140">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="FB140">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="FB140">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="FB140">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="FB140">P</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Nouvelle section Laine de Verre -->
                                <div class="library-section">
                                    <h5>🟨 Laine de Verre (Classique)</h5>
                                    <small class="section-description">Grand classique pour toitures - λ=0.035 - 120×60 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="LV60">
                                            <div class="item-icon">🟨</div>
                                            <div class="item-name">LV60</div>
                                            <div class="item-dimensions">120×60×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="LV60">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="LV60">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="LV60">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="LV60">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="LV60">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="LV100">
                                            <div class="item-icon">🟨</div>
                                            <div class="item-name">LV100</div>
                                            <div class="item-dimensions">120×100×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="LV100">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="LV100">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="LV100">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="LV100">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="LV100">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="LV140">
                                            <div class="item-icon">🟨</div>
                                            <div class="item-name">LV140</div>
                                            <div class="item-dimensions">120×140×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="LV140">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="LV140">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="LV140">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="LV140">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="LV140">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="LV200">
                                            <div class="item-icon">🟨</div>
                                            <div class="item-name">LV200</div>
                                            <div class="item-dimensions">120×200×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="LV200">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="LV200">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="LV200">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="LV200">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="LV200">P</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Nouvelle section Laine de Roche Moderne -->
                                <div class="library-section">
                                    <h5>🟤 Laine de Roche Moderne (Acoustique)</h5>
                                    <small class="section-description">Performances acoustiques et anti-feu - λ=0.038 - 100×60 cm</small>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="LRM60">
                                            <div class="item-icon">🟤</div>
                                            <div class="item-name">LRM60</div>
                                            <div class="item-dimensions">100×60×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="LRM60">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="LRM60">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="LRM60">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="LRM60">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="LRM60">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="LRM100">
                                            <div class="item-icon">🟤</div>
                                            <div class="item-name">LRM100</div>
                                            <div class="item-dimensions">100×100×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="LRM100">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="LRM100">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="LRM100">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="LRM100">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="LRM100">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="LRM140">
                                            <div class="item-icon">🟤</div>
                                            <div class="item-name">LRM140</div>
                                            <div class="item-dimensions">100×140×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="LRM140">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="LRM140">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="LRM140">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="LRM140">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="LRM140">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="LRM180">
                                            <div class="item-icon">🟤</div>
                                            <div class="item-name">LRM180</div>
                                            <div class="item-dimensions">100×180×60 mm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="LRM180">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="LRM180">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="LRM180">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="LRM180">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="LRM180">P</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Contenu bibliothèque linteaux -->
                            <div id="subtab-linteaux" class="subtab-content">
                                <div class="library-section">
                                    <h5>Linteaux Béton</h5>
                                    <div class="library-grid">
                                        <div class="library-item" data-type="L120">
                                            <div class="item-icon">🏗️</div>
                                            <div class="item-name">L120</div>
                                            <div class="item-dimensions">120×14×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="L120">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="L120">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="L120">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="L120">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="L120">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="L140">
                                            <div class="item-icon">🏗️</div>
                                            <div class="item-name">L140</div>
                                            <div class="item-dimensions">140×14×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="L140">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="L140">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="L140">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="L140">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="L140">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="L160">
                                            <div class="item-icon">🏗️</div>
                                            <div class="item-name">L160</div>
                                            <div class="item-dimensions">160×14×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="L160">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="L160">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="L160">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="L160">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="L160">P</button>
                                            </div>
                                        </div>
                                        <div class="library-item" data-type="L180">
                                            <div class="item-icon">🏗️</div>
                                            <div class="item-name">L180</div>
                                            <div class="item-dimensions">180×14×19 cm</div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="1/1" data-base-type="L180">1/1</button>
                                                <button class="cut-btn-mini" data-cut="3/4" data-base-type="L180">3/4</button>
                                                <button class="cut-btn-mini" data-cut="1/2" data-base-type="L180">1/2</button>
                                                <button class="cut-btn-mini" data-cut="1/4" data-base-type="L180">1/4</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="L180">P</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Contenu bibliothèque outils -->
                            <div id="subtab-outils" class="subtab-content">
                                <div class="library-section">
                                    <h5><i class="fas fa-tools"></i> Outils de Construction</h5>
                                    <div class="library-grid">
                                        <!-- Bétonnière -->
                                        <div class="library-item" data-type="betonniere" data-glb-path="assets/models/outils/betonniere.glb">
                                            <div class="preview-container">
                                                <canvas class="preview-3d" width="360" height="280" data-glb-path="assets/models/outils/betonniere.glb" data-glb-name="Bétonnière"></canvas>
                                                <div class="loading-indicator">
                                                    <div class="spinner"></div>
                                                    <span>Chargement...</span>
                                                </div>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">Bétonnière</div>
                                                <div class="item-specs">
                                                    <span class="spec-item">
                                                        <i class="fas fa-ruler-horizontal"></i> 100 cm
                                                    </span>
                                                    <span class="spec-item">
                                                        <i class="fas fa-ruler-vertical"></i> 80 cm
                                                    </span>
                                                    <span class="spec-item">
                                                        <i class="fas fa-arrows-alt-v"></i> 120 cm
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Brouette -->
                                        <div class="library-item" data-type="brouette" data-glb-path="assets/models/outils/brouette.glb">
                                            <div class="preview-container">
                                                <canvas class="preview-3d" width="360" height="280" data-glb-path="assets/models/outils/brouette.glb" data-glb-name="Brouette"></canvas>
                                                <div class="loading-indicator">
                                                    <div class="spinner"></div>
                                                    <span>Chargement...</span>
                                                </div>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">Brouette</div>
                                                <div class="item-specs">
                                                    <span class="spec-item">
                                                        <i class="fas fa-ruler-horizontal"></i> 150 cm
                                                    </span>
                                                    <span class="spec-item">
                                                        <i class="fas fa-ruler-vertical"></i> 60 cm
                                                    </span>
                                                    <span class="spec-item">
                                                        <i class="fas fa-arrows-alt-v"></i> 80 cm
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Contenu bibliothèque planchers -->
                            <div id="subtab-planchers" class="subtab-content">
                                <div class="library-section">
                                    <h5><i class="fas fa-layer-group"></i> Types de Planchers</h5>
                                    <div class="library-grid">
                                        <!-- Hourdis 13-60 GLB -->
                                        <div class="library-item" data-type="hourdis_13_60" data-glb-path="assets/models/planchers/hourdis_13_60.glb">
                                            <div class="item-preview">
                                                <canvas class="preview-3d" width="360" height="280" data-glb-path="assets/models/planchers/hourdis_13_60.glb" data-glb-name="Hourdis 13-60"></canvas>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">Hourdis 13-60</div>
                                                <div class="item-dimensions">60×13 cm</div>
                                            </div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="100" data-base-type="hourdis_13_60" data-glb-scale="1.0">100</button>
                                                <button class="cut-btn-mini" data-cut="200" data-base-type="hourdis_13_60" data-glb-scale="2.0">200</button>
                                                <button class="cut-btn-mini" data-cut="300" data-base-type="hourdis_13_60" data-glb-scale="3.0">300</button>
                                                <button class="cut-btn-mini" data-cut="400" data-base-type="hourdis_13_60" data-glb-scale="4.0">400</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="hourdis_13_60" data-glb-scale="P">P</button>
                                            </div>
                                        </div>

                                        <!-- Hourdis 16-60 GLB -->
                                        <div class="library-item" data-type="hourdis_16_60" data-glb-path="assets/models/planchers/hourdis_16_60.glb">
                                            <div class="item-preview">
                                                <canvas class="preview-3d" width="360" height="280" data-glb-path="assets/models/planchers/hourdis_16_60.glb" data-glb-name="Hourdis 16-60"></canvas>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">Hourdis 16-60</div>
                                                <div class="item-dimensions">60×16 cm</div>
                                            </div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="100" data-base-type="hourdis_16_60" data-glb-scale="1.0">100</button>
                                                <button class="cut-btn-mini" data-cut="200" data-base-type="hourdis_16_60" data-glb-scale="2.0">200</button>
                                                <button class="cut-btn-mini" data-cut="300" data-base-type="hourdis_16_60" data-glb-scale="3.0">300</button>
                                                <button class="cut-btn-mini" data-cut="400" data-base-type="hourdis_16_60" data-glb-scale="4.0">400</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="hourdis_16_60" data-glb-scale="P">P</button>
                                            </div>
                                        </div>

                                        <!-- Poutrain béton 12 GLB -->
                                        <div class="library-item" data-type="poutrain_beton_12" data-glb-path="assets/models/planchers/poutrain_beton_12.glb">
                                            <div class="item-preview">
                                                <canvas class="preview-3d" width="360" height="280" data-glb-path="assets/models/planchers/poutrain_beton_12.glb" data-glb-name="Poutrain béton 12"></canvas>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">Poutrain béton 12</div>
                                                <div class="item-dimensions">120×12×12 cm</div>
                                            </div>
                                            <div class="cut-buttons">
                                                <button class="cut-btn-mini" data-cut="100" data-base-type="poutrain_beton_12" data-glb-scale="0.83">100</button>
                                                <button class="cut-btn-mini" data-cut="200" data-base-type="poutrain_beton_12" data-glb-scale="1.67">200</button>
                                                <button class="cut-btn-mini" data-cut="300" data-base-type="poutrain_beton_12" data-glb-scale="2.5">300</button>
                                                <button class="cut-btn-mini" data-cut="400" data-base-type="poutrain_beton_12" data-glb-scale="3.33">400</button>
                                                <button class="cut-btn-mini" data-cut="P" data-base-type="poutrain_beton_12" data-glb-scale="P">P</button>
                                            </div>
                                        </div>

                                        <!-- Claveau béton 12-53 GLB -->
                                        <div class="library-item" data-type="claveau_beton_12_53" data-glb-path="assets/models/planchers/claveau_beton_12_53.glb">
                                            <div class="item-preview">
                                                <canvas class="preview-3d" width="360" height="280" data-glb-path="assets/models/planchers/claveau_beton_12_53.glb" data-glb-name="Claveau béton 12-53"></canvas>
                                            </div>
                                            <div class="item-info">
                                                <div class="item-name">Claveau béton 12-53</div>
                                                <div class="item-dimensions">53×12×12 cm</div>
                                            </div>
                                            <!-- Pas de boutons de coupe pour le claveau - taille fixe -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Contenu bibliothèque poutres -->
                            <div id="subtab-poutres" class="subtab-content">
                                <div class="library-section">
                                    <h5><i class="fas fa-grip-lines"></i> Types de Poutres</h5>
                                    <div class="library-grid">
                                        <!-- Les éléments poutres seront ajoutés ici -->
                                        <div class="library-placeholder">
                                            <div class="placeholder-icon">🏢</div>
                                            <div class="placeholder-text">Poutres à ajouter</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div> <!-- Fin main-subtab-bibliotheque -->
                            
                            <!-- Contenu Éléments à réutiliser -->
                            <div id="main-subtab-reutiliser" class="main-subtab-content">
                                <div class="reuse-section">
                                    <div class="reuse-header">
                                        <h5><i class="fas fa-recycle"></i> Éléments déjà utilisés</h5>
                                        <div class="reuse-actions">
                                            <button class="btn-reuse-refresh" onclick="tabManager.refreshReusableElements()">
                                                <i class="fas fa-sync"></i> Actualiser
                                            </button>
                                            <button class="btn-reuse-clear" onclick="tabManager.clearReusableElements()">
                                                <i class="fas fa-trash"></i> Vider
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Liste des éléments à réutiliser -->
                                    <div id="reusable-elements-list" class="reusable-elements">
                                        <div class="reuse-category">
                                            <h6><i class="fas fa-th"></i> Briques utilisées</h6>
                                            <div id="reused-bricks" class="reuse-grid">
                                                <!-- Les éléments seront ajoutés dynamiquement -->
                                                <div class="reuse-placeholder">
                                                    <i class="fas fa-info-circle"></i>
                                                    <p>Aucune brique utilisée pour le moment.</p>
                                                    <small>Les briques que vous placez apparaîtront ici pour être réutilisées.</small>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="reuse-category">
                                            <h6><i class="fas fa-square"></i> Blocs utilisés</h6>
                                            <div id="reused-blocks" class="reuse-grid">
                                                <div class="reuse-placeholder">
                                                    <i class="fas fa-info-circle"></i>
                                                    <p>Aucun bloc utilisé pour le moment.</p>
                                                    <small>Les blocs que vous placez apparaîtront ici pour être réutilisés.</small>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="reuse-category">
                                            <h6><i class="fas fa-cube"></i> Éléments GLB utilisés</h6>
                                            <div id="reused-glb" class="reuse-grid">
                                                <div class="reuse-placeholder">
                                                    <i class="fas fa-info-circle"></i>
                                                    <p>Aucun élément GLB utilisé pour le moment.</p>
                                                    <small>Les hourdis et autres éléments 3D apparaîtront ici pour être réutilisés.</small>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="reuse-category">
                                            <h6><i class="fas fa-layer-group"></i> Autres éléments</h6>
                                            <div id="reused-others" class="reuse-grid">
                                                <div class="reuse-placeholder">
                                                    <i class="fas fa-info-circle"></i>
                                                    <p>Aucun autre élément utilisé.</p>
                                                    <small>Les isolants, linteaux, etc. apparaîtront ici.</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Statistiques d'utilisation -->
                                    <div class="reuse-stats">
                                        <div class="reuse-stats-grid">
                                            <div class="reuse-stat-item">
                                                <span class="reuse-stat-value" id="reusedBricksCount">0</span>
                                                <span class="reuse-stat-label">Briques différentes</span>
                                            </div>
                                            <div class="reuse-stat-item">
                                                <span class="reuse-stat-value" id="reusedBlocksCount">0</span>
                                                <span class="reuse-stat-label">Blocs différents</span>
                                            </div>
                                            <div class="reuse-stat-item">
                                                <span class="reuse-stat-value" id="totalReusedCount">0</span>
                                                <span class="reuse-stat-label">Total utilisé</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> <!-- Fin main-subtab-reutiliser -->
                        </div>
                    </div>

                    <!-- Contenu onglet Textures -->
                    <div id="tab-content-textures" class="tab-content">
                        <div class="tool-section">
                            <h4>Matériaux et Textures</h4>
                            
                            <!-- Statistiques des matériaux -->
                            <div class="material-stats">
                                <div class="material-stats-grid">
                                    <div class="material-stat-item">
                                        <span class="material-stat-value" id="totalMaterials">50</span>
                                        <span class="material-stat-label">Matériaux</span>
                                    </div>
                                    <div class="material-stat-item">
                                        <span class="material-stat-value" id="totalSections">5</span>
                                        <span class="material-stat-label">Sections</span>
                                    </div>
                                    <div class="material-stat-item">
                                        <span class="material-stat-value" id="currentMaterial">-</span>
                                        <span class="material-stat-label">Sélectionné</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Recherche de matériaux -->
                            <div class="material-search">
                                <input type="text" id="materialSearchInput" placeholder="Rechercher un matériau..." autocomplete="off">
                                <span class="search-icon">🔍</span>
                                <button type="button" class="clear-search" id="clearMaterialSearch">×</button>
                            </div>
                            
                            <!-- Onglets Couleurs/Textures -->
                            <div class="material-tabs">
                                <button class="material-tab active" data-tab="colors">
                                    <i class="fas fa-palette"></i> Couleurs
                                </button>
                                <button class="material-tab" data-tab="textures">
                                    <i class="fas fa-image"></i> Textures
                                </button>
                            </div>

                            <!-- Contenu onglet Couleurs -->
                            <div id="material-colors-tab" class="material-tab-content active">
                                <!-- Section BOIS -->
                                <div class="material-section bois" data-section="bois">
                                    <div class="material-section-header">
                                        <span>🌳 BOIS</span>
                                        <span class="expand-icon">▼</span>
                                    </div>
                                    <div class="material-section-content">
                                        <div class="material-grid" id="bois-materials">
                                            <!-- Les matériaux seront ajoutés dynamiquement -->
                                        </div>
                                    </div>
                                </div>

                                <!-- Section PIERRES -->
                                <div class="material-section pierres" data-section="pierres">
                                    <div class="material-section-header">
                                        <span>🏔️ PIERRES</span>
                                        <span class="expand-icon">▼</span>
                                    </div>
                                    <div class="material-section-content">
                                        <div class="material-grid" id="pierres-materials">
                                            <!-- Les matériaux seront ajoutés dynamiquement -->
                                        </div>
                                    </div>
                                </div>

                                <!-- Section MÉTAUX -->
                                <div class="material-section metaux" data-section="metaux">
                                    <div class="material-section-header">
                                        <span>⚡ MÉTAUX</span>
                                        <span class="expand-icon">▼</span>
                                    </div>
                                    <div class="material-section-content">
                                        <div class="material-grid" id="metaux-materials">
                                            <!-- Les matériaux seront ajoutés dynamiquement -->
                                        </div>
                                    </div>
                                </div>

                                <!-- Section BRIQUES ET TUILES -->
                                <div class="material-section briques-tuiles" data-section="briques-tuiles">
                                    <div class="material-section-header">
                                        <span>🧱 BRIQUES ET TUILES</span>
                                        <span class="expand-icon">▼</span>
                                    </div>
                                    <div class="material-section-content">
                                        <div class="material-grid" id="briques-tuiles-materials">
                                            <!-- Les matériaux seront ajoutés dynamiquement -->
                                        </div>
                                    </div>
                                </div>

                                <!-- Section MATÉRIAUX MODERNES -->
                                <div class="material-section modernes-composites" data-section="modernes-composites">
                                    <div class="material-section-header">
                                        <span>🏗️ MATÉRIAUX MODERNES ET COMPOSITES</span>
                                        <span class="expand-icon">▼</span>
                                    </div>
                                    <div class="material-section-content">
                                        <div class="material-grid" id="modernes-composites-materials">
                                            <!-- Les matériaux seront ajoutés dynamiquement -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Contenu onglet Textures (à implémenter plus tard) -->
                            <div id="material-textures-tab" class="material-tab-content">
                                <div class="material-loading">
                                    <span>Textures à venir...</span>
                                </div>
                            </div>

                            <!-- Sélecteur de matériau actuel -->
                            <div class="material-selector">
                                <label for="materialSelect">Matériau actuel:</label>
                                <select id="materialSelect">
                                    <!-- Les options seront ajoutées dynamiquement -->
                                </select>
                            </div>

                            <!-- Informations sur le matériau sélectionné -->
                            <div class="material-info" id="selectedMaterialInfo" style="display: none;">
                                <h5>Informations sur le matériau</h5>
                                <div class="material-properties">
                                    <div class="property">
                                        <label>Nom:</label>
                                        <span id="materialInfoName">-</span>
                                    </div>
                                    <div class="property">
                                        <label>Couleur RGB:</label>
                                        <span id="materialInfoRgb">-</span>
                                    </div>
                                    <div class="property">
                                        <label>Description:</label>
                                        <span id="materialInfoDescription">-</span>
                                    </div>
                                </div>
                            </div>

                            <div class="tool-section">
                                <h4>Dimensions (cm)</h4>
                                <div class="dimension-inputs">
                                    <label>
                                        Longueur:
                                        <input type="number" id="elementLength" value="19" min="1" max="100">
                                    </label>
                                    <label>
                                        Largeur:
                                        <input type="number" id="elementWidth" value="9" min="1" max="50">
                                    </label>
                                    <label>
                                        Hauteur:
                                        <input type="number" id="elementHeight" value="5" min="1" max="30">
                                    </label>
                                </div>
                            </div>

                            <div class="tool-section">
                                <h4>Actions</h4>
                                <div class="action-buttons">
                                    <button id="placeElement" class="btn btn-success">Placer Élément</button>
                                    <button id="deleteElement" class="btn btn-danger">Supprimer</button>
                                    <button id="clearAll" class="btn btn-warning">Tout Effacer</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contenu onglet Joints -->
                    <div id="tab-content-joints" class="tab-content">
                        <!-- Section Joints de Briques -->
                        <div class="tool-section">
                            <h4><i class="fas fa-th"></i> Joints de Briques</h4>
                            
                            <div class="joint-controls">
                                <!-- Épaisseurs de joints fixes à 10mm (non modifiables) -->
                                <div class="form-group">
                                    <div class="joint-info" style="margin-bottom: 10px;">
                                        <strong>Épaisseurs des joints de briques (fixes) :</strong><br>
                                        • Joints horizontaux : 10mm<br>
                                        • Joints verticaux : 10mm
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="brickJointColor">Couleur joints briques:</label>
                                    <div class="color-palette" id="brickJointColorPalette">
                                        <!-- Les couleurs seront ajoutées dynamiquement -->
                                    </div>
                                    <div class="selected-color-info" id="selectedBrickColorInfo">
                                        <span class="color-name">Gris Ciment</span>
                                        <span class="color-code">#A9A9A9</span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="showBrickJoints" checked>
                                        Afficher joints briques
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="autoBrickJoints" checked>
                                        Joints briques automatiques
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Section Joints de Blocs -->
                        <div class="tool-section">
                            <h4><i class="fas fa-cube"></i> Joints de Blocs</h4>
                            
                            <div class="joint-controls">
                                <!-- Épaisseurs de joints fixes (non modifiables) -->
                                <div class="form-group">
                                    <div class="joint-info" style="margin-bottom: 10px;">
                                        <strong>Épaisseurs des joints de blocs :</strong><br>
                                        • <strong>Blocs creux</strong> (B9, B14, B19, B29) : 10mm<br>
                                        • <strong>Blocs béton cellulaire</strong> (BC_, BCA_) : 0mm (sans joints)
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Couleur joints blocs:</label>
                                    <div id="blockJointColorPalette" class="color-palette"></div>
                                    <div id="selectedBlockColorInfo" class="selected-color-info">
                                        <span class="color-name">Gris Ciment</span>
                                        <span class="color-hex">#A9A9A9</span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="showBlockJoints" checked>
                                        Afficher joints blocs
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="autoBlockJoints" checked>
                                        Joints blocs automatiques
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Section Générale -->
                        <div class="tool-section">
                            <h4><i class="fas fa-cogs"></i> Paramètres Généraux</h4>
                            
                            <div class="joint-controls">
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="showAllJoints" checked>
                                        Afficher tous les joints
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="syncJointSettings">
                                        Synchroniser les paramètres
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <button class="btn-secondary" id="resetJointSettings">
                                        <i class="fas fa-undo"></i> Réinitialiser
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contenu onglet Propriétés -->
                    <div id="tab-content-proprietes" class="tab-content">
                        <div class="tool-section">
                            <h4><i class="fas fa-cog"></i> Propriétés des Éléments</h4>
                            
                            <div class="properties-panel">
                                <div class="property-group">
                                    <h5>Élément Sélectionné</h5>
                    <div id="selectedElementProperties">
                        <p>Aucun élément sélectionné</p>
                    </div>
                </div>
                
                <div class="property-group modern-joints-control" id="jointsControlGroup" style="display: none;">
                    <div class="joints-header">
                        <div class="joints-icon">
                            <i class="fas fa-project-diagram"></i>
                        </div>
                        <h5>Gestion des Joints</h5>
                    </div>
                    <div class="joints-controls-modern">
                        <div class="joint-option" data-joint="left">
                            <div class="joint-toggle">
                                <div class="toggle-switch">
                                    <span class="toggle-slider"></span>
                                </div>
                            </div>
                            <div class="joint-info">
                                <span class="joint-title">Joint debout gauche</span>
                                <span class="joint-description">Contrôle l'affichage du joint vertical gauche</span>
                            </div>
                            <div class="joint-icon">
                                <i class="fas fa-grip-lines-vertical"></i>
                            </div>
                        </div>
                        <div class="joint-option" data-joint="right">
                            <div class="joint-toggle">
                                <div class="toggle-switch">
                                    <span class="toggle-slider"></span>
                                </div>
                            </div>
                            <div class="joint-info">
                                <span class="joint-title">Joint debout droite</span>
                                <span class="joint-description">Contrôle l'affichage du joint vertical droit</span>
                            </div>
                            <div class="joint-icon">
                                <i class="fas fa-grip-lines-vertical"></i>
                            </div>
                        </div>
                        <div class="joint-option" data-joint="horizontal">
                            <div class="joint-toggle">
                                <div class="toggle-switch">
                                    <span class="toggle-slider"></span>
                                </div>
                            </div>
                            <div class="joint-info">
                                <span class="joint-title">Joint horizontal inférieur</span>
                                <span class="joint-description">Contrôle l'affichage du joint horizontal</span>
                            </div>
                            <div class="joint-icon">
                                <i class="fas fa-grip-lines"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                            </div>
                        </div>
                    </div>

                    <!-- Contenu onglet Préférences -->
                    <div id="tab-content-preferences" class="tab-content">
                        <div class="tool-section">
                            <h4>Préférences</h4>
                            
                            <div class="preferences-panel">
                                <div class="preference-group">
                                    <h5>Interface</h5>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="showGrid">
                                            Afficher la grille
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="showAxis">
                                            Afficher les axes
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="autoSave" checked>
                                            Sauvegarde automatique
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="preference-group">
                                    <h5>Affichage</h5>
                                    <div class="form-group">
                                        <label for="viewMode">Mode de vue:</label>
                                        <select id="viewMode">
                                            <option value="solid">Solide</option>
                                            <option value="wireframe">Filaire</option>
                                            <option value="transparent">Transparent</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="backgroundCol">Couleur d'arrière-plan:</label>
                                        <input type="color" id="backgroundCol" value="#f0f0f0">
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="showAdjacentLetters" checked>
                                            🔤 Afficher les lettres de proposition adjacente
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="preference-group">
                                    <h5>Performance</h5>
                                    <div class="form-group">
                                        <label for="renderQuality">Qualité de rendu:</label>
                                        <select id="renderQuality">
                                            <option value="low">Faible</option>
                                            <option value="medium" selected>Moyenne</option>
                                            <option value="high">Élevée</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="preference-group">
                                    <h5>️ Interface Avancée</h5>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="showTooltips" checked>
                                            Afficher les infobulles
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="showShortcuts" checked>
                                            Raccourcis clavier activés
                                        </label>
                                    </div>
                                </div>

                                <div class="preference-group">
                                    <h5><i class="fas fa-cog"></i> Actions</h5>
                                    <div class="form-group">
                                        <button id="showHelp" class="btn btn-info">🛟 Aide & Raccourcis</button>
                                        <button id="startOnboarding" class="btn btn-success">🚀 Guide de démarrage</button>
                                        <button id="resetSettings" class="btn btn-warning"><i class="fas fa-sync"></i> Réinitialiser</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contenu onglet Ombres -->
                    <div id="tab-content-ombres" class="tab-content">
                        <div class="tool-section">
                            <h4>🌞 Simulation d'Ensoleillement et Ombres</h4>
                            <p class="shadow-description">
                                Visualisez l'impact du soleil sur votre construction selon la géolocalisation et l'orientation.
                            </p>
                            
                            <div class="shadows-panel">
                                <!-- Section Géolocalisation -->
                                <div class="shadow-group">
                                    <h5>📍 Géolocalisation du Projet</h5>
                                    <div class="geolocation-info">
                                        <p><strong>Position actuelle :</strong> <span id="currentLocation">Huy, Belgique</span></p>
                                        <p><small>📐 Latitude: <span id="currentLatitude">50.5196°N</span> | Longitude: <span id="currentLongitude">5.2325°E</span></small></p>
                                    </div>
                                    <div class="form-group">
                                        <label for="locationPreset">Choisir une ville :</label>
                                        <select id="locationPreset">
                                            <option value="huy" selected>🇧🇪 Huy, Belgique (50.52°N, 5.23°E)</option>
                                            <option value="brussels">🇧🇪 Bruxelles, Belgique (50.85°N, 4.35°E)</option>
                                            <option value="paris">🇫🇷 Paris, France (48.86°N, 2.35°E)</option>
                                            <option value="london">🇬🇧 Londres, Royaume-Uni (51.51°N, -0.13°E)</option>
                                            <option value="berlin">🇩🇪 Berlin, Allemagne (52.52°N, 13.40°E)</option>
                                            <option value="amsterdam">🇳🇱 Amsterdam, Pays-Bas (52.37°N, 4.90°E)</option>
                                            <option value="zurich">🇨🇭 Zurich, Suisse (47.37°N, 8.54°E)</option>
                                            <option value="custom"><i class="fas fa-edit"></i> Position personnalisée...</option>
                                        </select>
                                    </div>
                                    <div id="customLocationInputs" style="display: none;">
                                        <div class="form-group">
                                            <label for="customLatitude">Latitude (°) :</label>
                                            <input type="number" id="customLatitude" step="0.001" min="-90" max="90" placeholder="50.5196">
                                            <small>Nord: positif, Sud: négatif</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="customLongitude">Longitude (°) :</label>
                                            <input type="number" id="customLongitude" step="0.001" min="-180" max="180" placeholder="5.2325">
                                            <small>Est: positif, Ouest: négatif</small>
                                        </div>
                                        <button id="applyCustomLocation" class="btn btn-small">Appliquer</button>
                                    </div>
                                </div>

                                <!-- Section Orientation -->
                                <div class="shadow-group">
                                    <h5>🧭 Orientation du Terrain</h5>
                                    <div class="orientation-info">
                                        <p>Définissez l'orientation de votre terrain par rapport au Nord géographique.</p>
                                    </div>
                                    <div class="form-group">
                                        <label for="northOrientation">Orientation du Nord (°) :</label>
                                        <input type="range" id="northOrientation" min="0" max="360" step="5" value="0">
                                        <span id="northOrientationValue">0° (Nord en haut)</span>
                                    </div>
                                    <div class="compass-display">
                                        <div class="compass" id="compassDisplay">
                                            <div class="compass-needle" id="compassNeedle"></div>
                                            <div class="compass-label compass-n">N</div>
                                            <div class="compass-label compass-e">E</div>
                                            <div class="compass-label compass-s">S</div>
                                            <div class="compass-label compass-w">O</div>
                                        </div>
                                        <p class="compass-description">Boussole virtuelle montrant l'orientation actuelle</p>
                                    </div>
                                </div>

                                <!-- Section Date et Heure -->
                                <div class="shadow-group">
                                    <h5>📅 Date et Heure de Simulation</h5>
                                    <div class="datetime-controls">
                                        <div class="form-group">
                                            <label for="simulationDate">Date :</label>
                                            <input type="date" id="simulationDate">
                                            <button id="setToday" class="btn btn-small">Aujourd'hui</button>
                                        </div>
                                        <div class="form-group">
                                            <label for="simulationTime">Heure :</label>
                                            <input type="range" id="simulationTime" min="0" max="23" step="0.5" value="12">
                                            <span id="simulationTimeValue">12h00</span>
                                        </div>
                                        <div class="quick-times">
                                            <button class="time-preset" data-time="6">Lever ☀️</button>
                                            <button class="time-preset" data-time="12">Midi 🌞</button>
                                            <button class="time-preset" data-time="18">Coucher 🌇</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Section Position du Soleil -->
                                <div class="shadow-group">
                                    <h5>🌞 Position Solaire Calculée</h5>
                                    <div class="sun-info">
                                        <p><strong>Azimut solaire :</strong> <span id="calculatedAzimuth">180°</span> <small>(angle depuis le Nord)</small></p>
                                        <p><strong>Élévation solaire :</strong> <span id="calculatedElevation">45°</span> <small>(hauteur dans le ciel)</small></p>
                                    </div>
                                    <div class="sun-controls">
                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="useCalculatedSun" checked>
                                                Utiliser la position solaire calculée
                                            </label>
                                        </div>
                                        <div id="manualSunControls" style="display: none;">
                                            <div class="form-group">
                                                <label for="sunAzimuth">Azimut manuel (°) :</label>
                                                <input type="range" id="sunAzimuth" min="0" max="360" value="180">
                                                <span id="sunAzimuthValue">180°</span>
                                            </div>
                                            <div class="form-group">
                                                <label for="sunElevation">Élévation manuelle (°) :</label>
                                                <input type="range" id="sunElevation" min="0" max="90" value="45">
                                                <span id="sunElevationValue">45°</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Section Paramètres d'Éclairage -->
                                <div class="shadow-group">
                                    <h5>💡 Paramètres d'Éclairage</h5>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="enableShadows" checked>
                                            Activer les ombres portées
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label for="shadowIntensity">Intensité des ombres :</label>
                                        <input type="range" id="shadowIntensity" min="0" max="1" step="0.1" value="0.7">
                                        <span id="shadowIntensityValue">0.7</span>
                                    </div>
                                    <div class="form-group">
                                        <label for="ambientLight">Éclairage ambiant :</label>
                                        <input type="range" id="ambientLight" min="0.1" max="1" step="0.1" value="0.4">
                                        <span id="ambientLightValue">0.4</span>
                                    </div>
                                </div>
                                
                                <!-- Section Qualité -->
                                <div class="shadow-group">
                                    <h5><i class="fas fa-cog"></i> Qualité de Rendu</h5>
                                    <div class="form-group">
                                        <label for="shadowMapSize">Résolution des ombres :</label>
                                        <select id="shadowMapSize">
                                            <option value="512">512x512 (Rapide - mobiles)</option>
                                            <option value="1024" selected>1024x1024 (Standard - recommandé)</option>
                                            <option value="2048">2048x2048 (Haute qualité)</option>
                                            <option value="4096">4096x4096 (Ultra - performances requises)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="shadowSoftness">Adoucissement des ombres :</label>
                                        <input type="range" id="shadowSoftness" min="0" max="10" step="1" value="2">
                                        <span id="shadowSoftnessValue">2</span>
                                    </div>
                                </div>

                                <!-- Section Info Didactique -->
                                <div class="shadow-group shadow-info">
                                    <h5>ℹ️ Informations Pratiques</h5>
                                    <div class="info-content">
                                        <div class="info-item">
                                            <strong>🏗️ Impact Construction :</strong>
                                            <p>Les ombres portées influencent l'éclairage naturel des pièces et la performance énergétique du bâtiment.</p>
                                        </div>
                                        <div class="info-item">
                                            <strong>📐 Azimut Solaire :</strong>
                                            <p>0° = Nord, 90° = Est, 180° = Sud, 270° = Ouest</p>
                                        </div>
                                        <div class="info-item">
                                            <strong>📏 Élévation :</strong>
                                            <p>0° = horizon, 90° = zénith (soleil au-dessus)</p>
                                        </div>
                                        <div class="info-item">
                                            <strong>🌍 Position Géographique :</strong>
                                            <p>Influence grandement la trajectoire solaire selon la latitude et les saisons.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contenu onglet Métré -->
                    <div id="tab-content-metre" class="tab-content">
                        <div class="tool-section">
                            <h4><i class="fas fa-table"></i> Métré des Éléments</h4>
                            
                            <!-- Filtres et options -->
                            <div class="metre-controls">
                                <div class="control-row">
                                    <div class="control-group">
                                        <label for="filterType">Type:</label>
                                        <select id="filterType">
                                            <option value="all">Tous</option>
                                            <option value="brick">Briques</option>
                                            <option value="block">Blocs</option>
                                            <option value="insulation">Isolants</option>
                                            <option value="tool">Outils</option>
                                            <option value="glb">Modèles 3D</option>
                                        </select>
                                    </div>
                                    <div class="control-group">
                                        <label for="groupBy">Groupe:</label>
                                        <select id="groupBy">
                                            <option value="none">Aucun</option>
                                            <option value="type">Type</option>
                                            <option value="brick-type">M60, M65...</option>
                                            <option value="material">Matériau</option>
                                            <option value="dimensions">Dimensions</option>
                                        </select>
                                    </div>
                                    <div class="control-group">
                                        <button id="addManualItem" class="btn btn-info" title="Ajouter un outil ou objet manuellement">
                                            <i class="fas fa-plus"></i> Ajouter Outil
                                        </button>
                                        <button id="refreshMetre" class="btn btn-primary">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                        <button id="exportMetre" class="btn btn-success">
                                            <i class="fas fa-file-export"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Tableau des éléments -->
                            <div class="metre-table-container">
                                <table class="metre-table" id="metreTable">
                                    <thead>
                                        <tr>
                                            <th style="width: 80px;">ID</th>
                                            <th class="sortable" data-sort="type">
                                                <i class="fas fa-cube"></i> Type
                                                <span class="sort-indicator"></span>
                                            </th>
                                            <th class="sortable" data-sort="material">
                                                <i class="fas fa-palette"></i> Matériau
                                                <span class="sort-indicator"></span>
                                            </th>
                                            <th class="sortable" data-sort="dimensions">
                                                <i class="fas fa-ruler-combined"></i> LxlxH
                                                <span class="sort-indicator"></span>
                                            </th>
                                            <th>Position</th>
                                            <th>Volume (m³)</th>
                                            <th>Masse (kg)</th>
                                            <th class="sortable" data-sort="quantity">
                                                <i class="fas fa-hashtag"></i> Quantité
                                                <span class="sort-indicator"></span>
                                            </th>
                                            <th class="totals-column">
                                                <i class="fas fa-cogs"></i> Actions
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="metreTableBody">
                                        <!-- Les lignes seront générées dynamiquement -->
                                        <tr class="empty-state">
                                            <td colspan="9" class="text-center">
                                                <div class="empty-message">
                                                    <i class="fas fa-inbox"></i>
                                                    <p>Aucun élément placé dans la scène</p>
                                                    <small>Commencez par placer des éléments pour voir le métré</small>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Statistiques globales -->
                            <div class="metre-summary">
                                <div class="summary-stats">
                                    <div class="stat-box">
                                        <div class="stat-value" id="totalElements">0</div>
                                        <div class="stat-label">Total Éléments</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value" id="totalVolumeMetre">0.00 m³</div>
                                        <div class="stat-label">Volume Total</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value" id="totalMassMetre">0.00 kg</div>
                                        <div class="stat-label">Masse Totale</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Légende et informations -->
                            <div class="metre-legend">
                                <h5><i class="fas fa-info-circle"></i> Informations</h5>
                                <div class="legend-content">
                                    <div class="legend-item">
                                        <span class="icon-type brick"><i class="fas fa-square"></i></span>
                                        <span>Briques - Éléments de maçonnerie traditionnelle</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="icon-type block"><i class="fas fa-cube"></i></span>
                                        <span>Blocs - Éléments de construction modulaires</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="icon-type insulation"><i class="fas fa-th-large"></i></span>
                                        <span>Isolants - Matériaux d'isolation thermique</span>
                                    </div>
                                </div>
                                <div class="calculation-note">
                                    <p><strong>Note :</strong> Les calculs de masse utilisent les densités réelles des matériaux : briques d'argile 1700-1920 kg/m³, béton cellulaire ~600 kg/m³, isolants 30-50 kg/m³. Les volumes sont calculés sur les dimensions nettes des éléments.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contenu onglet Projet -->
                    <div id="tab-content-projet" class="tab-content">
                        <div class="tool-section">
                            <h4>Informations de Projet</h4>
                            
                            <div class="project-panel">
                                <div class="project-group">
                                    <h5>Identification</h5>
                                    <div class="form-group">
                                        <label for="projectName">Nom du projet:</label>
                                        <input type="text" id="projectName" placeholder="Nom du projet à définir">
                                    </div>
                                    <div class="form-group">
                                        <label for="projectDesigner">Nom du dessinateur:</label>
                                        <input type="text" id="projectDesigner" placeholder="Nom du dessinateur">
                                    </div>
                                    <div class="form-group">
                                        <label for="projectClass">Classe:</label>
                                        <input type="text" id="projectClass" placeholder="Classe ou niveau d'enseignement">
                                    </div>
                                </div>
                                
                                <div class="project-group">
                                    <h5>Notes</h5>
                                    <div class="form-group">
                                        <textarea id="projectNotes" rows="4" placeholder="Notes, observations, remarques particulières..."></textarea>
                                    </div>
                                </div>
                                
                                <div class="project-group">
                                    <h5>Statistiques</h5>
                                    <div class="stats-grid">
                                        <div class="stat-item">
                                            <div class="stat-label">Éléments placés:</div>
                                            <div class="stat-value" id="elementsCount">0</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">Briques:</div>
                                            <div class="stat-value" id="bricksCount">0</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">Blocs:</div>
                                            <div class="stat-value" id="blocksCount">0</div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-label">Volume total (m³):</div>
                                            <div class="stat-value" id="totalVolume">0.00</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="project-group">
                                    <h5>Actions</h5>
                                    <div class="project-buttons">
                                        <button class="btn btn-warning" id="clearProject">
                                            <span class="icon">🗑️</span>
                                            Vider le projet
                                        </button>
                                        <button class="btn btn-info" id="resetView">
                                            <span class="icon"><i class="fas fa-sync"></i></span>
                                            Réinitialiser la vue
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contenu onglet Calques -->
                    <div id="tab-content-calques" class="tab-content">
                        <div class="tool-section">
                            <h4><i class="fas fa-layer-group"></i> Gestion des Calques</h4>
                            
                            <div class="layer-system">
                                <!-- Contrôles généraux -->
                                <div class="layer-controls">
                                    <div class="control-buttons">
                                        <button id="toggleAllLayers" class="btn btn-sm btn-primary">
                                            <i class="fas fa-eye"></i> Tout afficher
                                        </button>
                                        <button id="hideAllLayers" class="btn btn-sm btn-secondary">
                                            <i class="fas fa-eye-slash"></i> Tout masquer
                                        </button>
                                        <button id="isolateSelectedLayer" class="btn btn-sm btn-info">
                                            <i class="fas fa-bullseye"></i> Isoler sélection
                                        </button>
                                    </div>
                                    
                                    <div class="layer-stats">
                                        <div class="stat-item">
                                            <span class="stat-label">Calques actifs:</span>
                                            <span class="stat-value" id="activeLayersCount">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">Éléments visibles:</span>
                                            <span class="stat-value" id="visibleElementsCount">0</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Liste des calques -->
                                <div class="layers-list">
                                    <h5><i class="fas fa-list"></i> Calques par Type</h5>
                                    
                                    <!-- Calque Briques M65 -->
                                    <div class="layer-item" data-layer="briques-m65">
                                        <div class="layer-header">
                                            <div class="layer-info">
                                                <span class="layer-icon"><i class="fas fa-square" style="color: #D2691E;"></i></span>
                                                <span class="layer-name">Briques M65</span>
                                                <span class="layer-count" id="briques-m65-count">0</span>
                                            </div>
                                            <div class="layer-controls">
                                                <button class="layer-visibility-btn active" data-layer="briques-m65">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="layer-lock-btn" data-layer="briques-m65">
                                                    <i class="fas fa-unlock"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layer-details">
                                            <div class="layer-properties">
                                                <div class="property-item">
                                                    <label>Opacité:</label>
                                                    <input type="range" class="layer-opacity" data-layer="briques-m65" 
                                                           min="0" max="100" value="100">
                                                    <span class="opacity-value">100%</span>
                                                </div>
                                                <div class="property-item">
                                                    <label>Couleur:</label>
                                                    <input type="color" class="layer-color" data-layer="briques-m65" 
                                                           value="#D2691E">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Calque Blocs Creux -->
                                    <div class="layer-item" data-layer="blocs-creux">
                                        <div class="layer-header">
                                            <div class="layer-info">
                                                <span class="layer-icon"><i class="fas fa-cube" style="color: #808080;"></i></span>
                                                <span class="layer-name">Blocs Creux</span>
                                                <span class="layer-count" id="blocs-creux-count">0</span>
                                            </div>
                                            <div class="layer-controls">
                                                <button class="layer-visibility-btn active" data-layer="blocs-creux">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="layer-lock-btn" data-layer="blocs-creux">
                                                    <i class="fas fa-unlock"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layer-details">
                                            <div class="layer-properties">
                                                <div class="property-item">
                                                    <label>Opacité:</label>
                                                    <input type="range" class="layer-opacity" data-layer="blocs-creux" 
                                                           min="0" max="100" value="100">
                                                    <span class="opacity-value">100%</span>
                                                </div>
                                                <div class="property-item">
                                                    <label>Couleur:</label>
                                                    <input type="color" class="layer-color" data-layer="blocs-creux" 
                                                           value="#808080">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Calque Joints Horizontaux -->
                                    <div class="layer-item" data-layer="joints-horizontaux">
                                        <div class="layer-header">
                                            <div class="layer-info">
                                                <span class="layer-icon"><i class="fas fa-minus" style="color: #9E9E9E;"></i></span>
                                                <span class="layer-name">Joints Horizontaux</span>
                                                <span class="layer-count" id="joints-horizontaux-count">0</span>
                                            </div>
                                            <div class="layer-controls">
                                                <button class="layer-visibility-btn active" data-layer="joints-horizontaux">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="layer-lock-btn" data-layer="joints-horizontaux">
                                                    <i class="fas fa-unlock"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layer-details">
                                            <div class="layer-properties">
                                                <div class="property-item">
                                                    <label>Opacité:</label>
                                                    <input type="range" class="layer-opacity" data-layer="joints-horizontaux" 
                                                           min="0" max="100" value="100">
                                                    <span class="opacity-value">100%</span>
                                                </div>
                                                <div class="property-item">
                                                    <label>Couleur:</label>
                                                    <input type="color" class="layer-color" data-layer="joints-horizontaux" 
                                                           value="#9E9E9E">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Calque Joints Verticaux -->
                                    <div class="layer-item" data-layer="joints-verticaux">
                                        <div class="layer-header">
                                            <div class="layer-info">
                                                <span class="layer-icon"><i class="fas fa-grip-lines-vertical" style="color: #9E9E9E;"></i></span>
                                                <span class="layer-name">Joints Verticaux</span>
                                                <span class="layer-count" id="joints-verticaux-count">0</span>
                                            </div>
                                            <div class="layer-controls">
                                                <button class="layer-visibility-btn active" data-layer="joints-verticaux">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="layer-lock-btn" data-layer="joints-verticaux">
                                                    <i class="fas fa-unlock"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layer-details">
                                            <div class="layer-properties">
                                                <div class="property-item">
                                                    <label>Opacité:</label>
                                                    <input type="range" class="layer-opacity" data-layer="joints-verticaux" 
                                                           min="0" max="100" value="100">
                                                    <span class="opacity-value">100%</span>
                                                </div>
                                                <div class="property-item">
                                                    <label>Couleur:</label>
                                                    <input type="color" class="layer-color" data-layer="joints-verticaux" 
                                                           value="#9E9E9E">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Calque Isolants -->
                                    <div class="layer-item" data-layer="isolants">
                                        <div class="layer-header">
                                            <div class="layer-info">
                                                <span class="layer-icon"><i class="fas fa-th-large" style="color: #FFD700;"></i></span>
                                                <span class="layer-name">Isolants</span>
                                                <span class="layer-count" id="isolants-count">0</span>
                                            </div>
                                            <div class="layer-controls">
                                                <button class="layer-visibility-btn active" data-layer="isolants">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="layer-lock-btn" data-layer="isolants">
                                                    <i class="fas fa-unlock"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layer-details">
                                            <div class="layer-properties">
                                                <div class="property-item">
                                                    <label>Opacité:</label>
                                                    <input type="range" class="layer-opacity" data-layer="isolants" 
                                                           min="0" max="100" value="80">
                                                    <span class="opacity-value">80%</span>
                                                </div>
                                                <div class="property-item">
                                                    <label>Couleur:</label>
                                                    <input type="color" class="layer-color" data-layer="isolants" 
                                                           value="#FFD700">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Calque Linteaux -->
                                    <div class="layer-item" data-layer="linteaux">
                                        <div class="layer-header">
                                            <div class="layer-info">
                                                <span class="layer-icon">🏗️</span>
                                                <span class="layer-name">Linteaux</span>
                                                <span class="layer-count" id="linteaux-count">0</span>
                                            </div>
                                            <div class="layer-controls">
                                                <button class="layer-visibility-btn active" data-layer="linteaux">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="layer-lock-btn" data-layer="linteaux">
                                                    <i class="fas fa-unlock"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layer-details">
                                            <div class="layer-properties">
                                                <div class="property-item">
                                                    <label>Opacité:</label>
                                                    <input type="range" class="layer-opacity" data-layer="linteaux" 
                                                           min="0" max="100" value="100">
                                                    <span class="opacity-value">100%</span>
                                                </div>
                                                <div class="property-item">
                                                    <label>Couleur:</label>
                                                    <input type="color" class="layer-color" data-layer="linteaux" 
                                                           value="#708090">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Calque Cotations -->
                                    <div class="layer-item" data-layer="cotations">
                                        <div class="layer-header">
                                            <div class="layer-info">
                                                <span class="layer-icon"><i class="fas fa-ruler" style="color: #FF4444;"></i></span>
                                                <span class="layer-name">Cotations</span>
                                                <span class="layer-count" id="cotations-count">0</span>
                                            </div>
                                            <div class="layer-controls">
                                                <button class="layer-visibility-btn active" data-layer="cotations">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="layer-lock-btn" data-layer="cotations">
                                                    <i class="fas fa-unlock"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layer-details">
                                            <div class="layer-properties">
                                                <div class="property-item">
                                                    <label>Opacité:</label>
                                                    <input type="range" class="layer-opacity" data-layer="cotations" 
                                                           min="0" max="100" value="100">
                                                    <span class="opacity-value">100%</span>
                                                </div>
                                                <div class="property-item">
                                                    <label>Couleur:</label>
                                                    <input type="color" class="layer-color" data-layer="cotations" 
                                                           value="#FF4444">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Calque Annotations -->
                                    <div class="layer-item" data-layer="annotations">
                                        <div class="layer-header">
                                            <div class="layer-info">
                                                <span class="layer-icon"><i class="fas fa-comment" style="color: #4444FF;"></i></span>
                                                <span class="layer-name">Annotations</span>
                                                <span class="layer-count" id="annotations-count">0</span>
                                            </div>
                                            <div class="layer-controls">
                                                <button class="layer-visibility-btn active" data-layer="annotations">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="layer-lock-btn" data-layer="annotations">
                                                    <i class="fas fa-unlock"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layer-details">
                                            <div class="layer-properties">
                                                <div class="property-item">
                                                    <label>Opacité:</label>
                                                    <input type="range" class="layer-opacity" data-layer="annotations" 
                                                           min="0" max="100" value="100">
                                                    <span class="opacity-value">100%</span>
                                                </div>
                                                <div class="property-item">
                                                    <label>Couleur:</label>
                                                    <input type="color" class="layer-color" data-layer="annotations" 
                                                           value="#4444FF">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Calque Textes avec ligne -->
                                    <div class="layer-item" data-layer="textes">
                                        <div class="layer-header">
                                            <div class="layer-info">
                                                <span class="layer-icon"><i class="fas fa-comment-dots" style="color: #44FF44;"></i></span>
                                                <span class="layer-name">Textes avec ligne</span>
                                                <span class="layer-count" id="textes-count">0</span>
                                            </div>
                                            <div class="layer-controls">
                                                <button class="layer-visibility-btn active" data-layer="textes">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="layer-lock-btn" data-layer="textes">
                                                    <i class="fas fa-unlock"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layer-details">
                                            <div class="layer-properties">
                                                <div class="property-item">
                                                    <label>Opacité:</label>
                                                    <input type="range" class="layer-opacity" data-layer="textes" 
                                                           min="0" max="100" value="100">
                                                    <span class="opacity-value">100%</span>
                                                </div>
                                                <div class="property-item">
                                                    <label>Couleur:</label>
                                                    <input type="color" class="layer-color" data-layer="textes" 
                                                           value="#44FF44">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Options avancées -->
                                <div class="layer-advanced">
                                    <h5><i class="fas fa-cog"></i> Options Avancées</h5>
                                    
                                    <div class="advanced-controls">
                                        <div class="control-group">
                                            <label>
                                                <input type="checkbox" id="autoLayerAssignment" checked>
                                                Assignation automatique des calques
                                            </label>
                                            <small>Les nouveaux éléments sont automatiquement placés dans le bon calque</small>
                                        </div>
                                        
                                        <div class="control-group">
                                            <label>
                                                <input type="checkbox" id="layerColorOverride">
                                                Forcer les couleurs des calques
                                            </label>
                                            <small>Applique la couleur du calque à tous ses éléments</small>
                                        </div>
                                        
                                        <div class="control-group">
                                            <label>
                                                <input type="checkbox" id="showLayerPreview" checked>
                                                Aperçu en temps réel
                                            </label>
                                            <small>Mise à jour immédiate lors des modifications</small>
                                        </div>
                                    </div>
                                    
                                    <div class="layer-actions">
                                        <button id="refreshLayers" class="btn btn-sm btn-secondary">
                                            <i class="fas fa-sync"></i> Actualiser les calques
                                        </button>
                                        <button id="resetLayerSettings" class="btn btn-sm btn-warning">
                                            <i class="fas fa-undo"></i> Réinitialiser
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contenu onglet Mode opératoire -->
                    <div id="tab-content-mode-operatoire" class="tab-content">
                        <div class="tool-section">
                            <h4><i class="fas fa-list-ol"></i> Mode Opératoire Détaillé</h4>
                            
                            <div class="project-panel">
                                <div class="project-group">
                                    <h5>Description complète du mode opératoire</h5>
                                    <div class="form-group">
                                        <textarea id="detailedProcedure" rows="8" placeholder="Rédigez ici le mode opératoire détaillé avec toutes les étapes de construction, les techniques utilisées, les points de contrôle qualité..."></textarea>
                                    </div>
                                </div>
                                
                                <div class="project-group" style="margin-top: 20px;">
                                    <h5>Points clés et recommandations</h5>
                                    <div class="form-group">
                                        <textarea id="procedureRecommendations" rows="4" placeholder="Ajoutez ici les recommandations spéciales, les points d'attention sécurité, les bonnes pratiques..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

            </aside>
        </div>
    </div>

    <!-- Fenêtre modale d'exportation PDF -->
    <div class="presentation-modal" id="presentationModal" style="display: none;">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-pdf"></i> Exportation PDF - Présentation</h3>
                <button class="modal-close" id="closeModalBtn">×</button>
            </div>
            
            <div class="modal-body">
                <div class="export-settings">
                    <h4>Options d'exportation</h4>
                    
                    <div class="export-content">
                        <div class="export-column">
                            <div class="pages-selection">
                                <h5>Pages à inclure :</h5>
                                <div class="pages-selection-container">
                                    <div class="pages-selection-help">
                                        <p><i class="fas fa-info-circle"></i> Glissez-déposez les pages entre les colonnes ou utilisez les boutons de transfert.</p>
                                    </div>
                                    
                                    <div class="pages-container">
                                        <div class="pages-list-container">
                                            <h6>Pages disponibles</h6>
                                            <div class="pages-list available" id="availablePages">
                                                <!-- Les pages disponibles seront ajoutées ici dynamiquement -->
                                            </div>
                                        </div>
                                        
                                        <div class="pages-transfer-controls">
                                            <button type="button" class="transfer-btn" id="addPagesToExport" title="Ajouter à l'export">
                                                <i class="fas fa-arrow-right"></i>
                                            </button>
                                            <button type="button" class="transfer-btn" id="removePagesFromExport" title="Retirer de l'export">
                                                <i class="fas fa-arrow-left"></i>
                                            </button>
                                            <button type="button" class="transfer-btn" id="addAllPagesToExport" title="Tout ajouter">
                                                <i class="fas fa-angle-double-right"></i>
                                            </button>
                                            <button type="button" class="transfer-btn" id="removeAllPagesFromExport" title="Tout retirer">
                                                <i class="fas fa-angle-double-left"></i>
                                            </button>
                                        </div>
                                        
                                        <div class="pages-list-container">
                                            <h6>Pages à exporter</h6>
                                            <div class="pages-list export" id="exportPages">
                                                <!-- Les pages sélectionnées pour l'export seront ajoutées ici -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="export-column">
                            <div class="assise-cuts-section" id="assiseCutsSection">
                                <h5>Coupes d'assises :</h5>
                                <div class="assise-cuts-help">
                                    <p><i class="fas fa-info-circle"></i> Sélectionnez les assises pour générer des vues en plan au niveau supérieur.</p>
                                </div>
                                
                                <div class="assise-cuts-container">
                                    <div class="assise-list-container">
                                        <h6>Assises disponibles</h6>
                                        <div class="assise-list available" id="availableAssises">
                                            <!-- Les assises disponibles seront ajoutées ici dynamiquement -->
                                        </div>
                                    </div>
                                    
                                    <div class="assise-transfer-controls">
                                        <button type="button" class="transfer-btn" id="addAssiseToExport" title="Ajouter à l'export">
                                            <i class="fas fa-arrow-right"></i>
                                        </button>
                                        <button type="button" class="transfer-btn" id="removeAssiseFromExport" title="Retirer de l'export">
                                            <i class="fas fa-arrow-left"></i>
                                        </button>
                                        <button type="button" class="transfer-btn" id="addAllAssisesToExport" title="Tout ajouter">
                                            <i class="fas fa-angle-double-right"></i>
                                        </button>
                                        <button type="button" class="transfer-btn" id="removeAllAssisesFromExport" title="Tout retirer">
                                            <i class="fas fa-angle-double-left"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="assise-list-container">
                                        <h6>Assises à exporter</h6>
                                        <div class="assise-list export" id="exportAssises">
                                            <!-- Les assises sélectionnées pour l'export seront ajoutées ici -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Format de papier déplacé ici -->
                            <div class="format-settings">
                                <h5>Format d'export :</h5>
                                <div class="setting-item">
                                    <span class="setting-label">Format :</span>
                                    <span class="setting-value">A4 Paysage</span>
                                </div>
                            </div>
                            
                            <!-- Boutons d'action juste en dessous du format -->
                            <div class="export-actions">
                                <div class="export-progress" id="exportProgress" style="display: none;">
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="progressFill"></div>
                                    </div>
                                    <span class="progress-text" id="progressText">Génération en cours...</span>
                                </div>
                                
                                <div class="modal-actions">
                                    <button class="btn btn-secondary" id="cancelExportBtn">Annuler</button>
                                    <button class="btn btn-primary" id="generatePdfBtn">
                                        <i class="fas fa-file-pdf"></i>
                                        Générer PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts JS -->
    <script src="lib/jspdf/jspdf.umd.min.js"></script>
    <script src="lib/html2canvas/html2canvas.min.js"></script>
    
    <!-- Configuration des facteurs d'échelle réinitialisés -->
    <script src="js/scale-factors-config.js"></script>
    
    <script src="js/presentation-manager.js"></script>

    <!-- Modale de sélection de briques -->
    <div id="brickSelector" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sélection du type de brique</h2>
                <button class="close-btn" id="closeBrickSelector">&times;</button>
            </div>
            <div class="modal-body">
                <div class="simple-brick-library">
                    <!-- Brique M50 -->
                    <div class="brick-type-section">
                        <h3>Brique M50 <span class="dimensions">19×5×9 cm</span></h3>
                        <div class="size-buttons">
                            <button class="size-btn" data-type="M50" data-length="19">
                                <span class="fraction">1/1</span>
                                <span class="dimension">19cm</span>
                            </button>
                            <button class="size-btn" data-type="M50_3Q" data-length="14">
                                <span class="fraction">3/4</span>
                                <span class="dimension">14cm</span>
                            </button>
                            <button class="size-btn" data-type="M50_HALF" data-length="9">
                                <span class="fraction">1/2</span>
                                <span class="dimension">9cm</span>
                            </button>
                            <button class="size-btn" data-type="M50_1Q" data-length="4">
                                <span class="fraction">1/4</span>
                                <span class="dimension">4cm</span>
                            </button>
                            <button class="size-btn custom-cut-btn" data-type="M50" data-custom-cut="true">
                                <span class="fraction">✂️</span>
                                <span class="dimension">Personnalisée</span>
                            </button>
                        </div>
                    </div>

                    <!-- Brique M57 -->
                    <div class="brick-type-section">
                        <h3>Brique M57 <span class="dimensions">19×5.7×9 cm</span></h3>
                        <div class="size-buttons">
                            <button class="size-btn" data-type="M57" data-length="19">
                                <span class="fraction">1/1</span>
                                <span class="dimension">19cm</span>
                            </button>
                            <button class="size-btn" data-type="M57_3Q" data-length="14">
                                <span class="fraction">3/4</span>
                                <span class="dimension">14cm</span>
                            </button>
                            <button class="size-btn" data-type="M57_HALF" data-length="9">
                                <span class="fraction">1/2</span>
                                <span class="dimension">9cm</span>
                            </button>
                            <button class="size-btn" data-type="M57_1Q" data-length="4">
                                <span class="fraction">1/4</span>
                                <span class="dimension">4cm</span>
                            </button>
                            <button class="size-btn custom-cut-btn" data-type="M57" data-custom-cut="true">
                                <span class="fraction">✂️</span>
                                <span class="dimension">Personnalisée</span>
                            </button>
                        </div>
                    </div>

                    <!-- Brique M60 -->
                    <div class="brick-type-section">
                        <h3>Brique M60 <span class="dimensions">19×6×9 cm</span></h3>
                        <div class="size-buttons">
                            <button class="size-btn" data-type="M60" data-length="19">
                                <span class="fraction">1/1</span>
                                <span class="dimension">19cm</span>
                            </button>
                            <button class="size-btn" data-type="M60_3Q" data-length="14">
                                <span class="fraction">3/4</span>
                                <span class="dimension">14cm</span>
                            </button>
                            <button class="size-btn" data-type="M60_HALF" data-length="9">
                                <span class="fraction">1/2</span>
                                <span class="dimension">9cm</span>
                            </button>
                            <button class="size-btn" data-type="M60_1Q" data-length="4">
                                <span class="fraction">1/4</span>
                                <span class="dimension">4cm</span>
                            </button>
                            <button class="size-btn custom-cut-btn" data-type="M60" data-custom-cut="true">
                                <span class="fraction">✂️</span>
                                <span class="dimension">Personnalisée</span>
                            </button>
                        </div>
                    </div>

                    <!-- Brique M65 (par défaut) -->
                    <div class="brick-type-section default-brick">
                        <h3>Brique M65 <span class="dimensions">19×6.5×9 cm</span> <span class="default-label">Par défaut</span></h3>
                        <div class="size-buttons">
                            <button class="size-btn active" data-type="M65" data-length="19">
                                <span class="fraction">1/1</span>
                                <span class="dimension">19cm</span>
                            </button>
                            <button class="size-btn" data-type="M65_3Q" data-length="14">
                                <span class="fraction">3/4</span>
                                <span class="dimension">14cm</span>
                            </button>
                            <button class="size-btn" data-type="M65_HALF" data-length="9">
                                <span class="fraction">1/2</span>
                                <span class="dimension">9cm</span>
                            </button>
                            <button class="size-btn" data-type="M65_1Q" data-length="4">
                                <span class="fraction">1/4</span>
                                <span class="dimension">4cm</span>
                            </button>
                            <button class="size-btn custom-cut-btn" data-type="M65" data-custom-cut="true">
                                <span class="fraction">✂️</span>
                                <span class="dimension">Personnalisée</span>
                            </button>
                        </div>
                    </div>

                    <!-- Brique M90 -->
                    <div class="brick-type-section">
                        <h3>Brique M90 <span class="dimensions">19×9×9 cm</span></h3>
                        <div class="size-buttons">
                            <button class="size-btn" data-type="M90" data-length="19">
                                <span class="fraction">1/1</span>
                                <span class="dimension">19cm</span>
                            </button>
                            <button class="size-btn" data-type="M90_3Q" data-length="14">
                                <span class="fraction">3/4</span>
                                <span class="dimension">14cm</span>
                            </button>
                            <button class="size-btn" data-type="M90_HALF" data-length="9">
                                <span class="fraction">1/2</span>
                                <span class="dimension">9cm</span>
                            </button>
                            <button class="size-btn" data-type="M90_1Q" data-length="4">
                                <span class="fraction">1/4</span>
                                <span class="dimension">4cm</span>
                            </button>
                            <button class="size-btn custom-cut-btn" data-type="M90" data-custom-cut="true">
                                <span class="fraction">✂️</span>
                                <span class="dimension">Personnalisée</span>
                            </button>
                        </div>
                    </div>

                    <!-- Brique M50 sur chant -->
                    <div class="brick-type-section">
                        <h3>Brique M50 sur chant <span class="dimensions">5×19×9 cm</span></h3>
                        <div class="size-buttons">
                            <button class="size-btn" data-type="M50_CHANT" data-length="5">
                                <span class="fraction">1/1</span>
                                <span class="dimension">5cm</span>
                            </button>
                            <button class="size-btn" data-type="M50_CHANT_3Q" data-length="3.75">
                                <span class="fraction">3/4</span>
                                <span class="dimension">3.75cm</span>
                            </button>
                            <button class="size-btn" data-type="M50_CHANT_HALF" data-length="2.5">
                                <span class="fraction">1/2</span>
                                <span class="dimension">2.5cm</span>
                            </button>
                            <button class="size-btn" data-type="M50_CHANT_1Q" data-length="1.25">
                                <span class="fraction">1/4</span>
                                <span class="dimension">1.25cm</span>
                            </button>
                            <button class="size-btn custom-cut-btn" data-type="M50_CHANT" data-custom-cut="true">
                                <span class="fraction">✂️</span>
                                <span class="dimension">Personnalisée</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelBrickSelection" class="btn btn-secondary">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Modale de sélection de blocs -->
    <div id="blockSelector" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sélection du type de bloc</h2>
                <button class="close-btn" id="closeBlockSelector">&times;</button>
            </div>
            <div class="modal-body">
                <div class="simple-block-library">
                    <!-- Blocs creux -->
                    <div class="block-category-section">
                        <h3 class="category-title">Blocs creux</h3>
                        
                        <!-- Bloc creux B9 -->
                        <div class="block-type-section">
                            <h4>Bloc creux B9 <span class="dimensions">39×9×19 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn" data-type="B9" data-length="39">
                                    <span class="fraction">1/1</span>
                                    <span class="dimension">39cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B9_3Q" data-length="29">
                                    <span class="fraction">3/4</span>
                                    <span class="dimension">29cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B9_HALF" data-length="19">
                                    <span class="fraction">1/2</span>
                                    <span class="dimension">19cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B9_1Q" data-length="9">
                                    <span class="fraction">1/4</span>
                                    <span class="dimension">9cm</span>
                                </button>
                                <button class="block-size-btn custom-cut-btn" data-type="B9" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <!-- Bloc creux B14 -->
                        <div class="block-type-section">
                            <h4>Bloc creux B14 <span class="dimensions">39×14×19 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn" data-type="B14" data-length="39">
                                    <span class="fraction">1/1</span>
                                    <span class="dimension">39cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B14_3Q" data-length="29">
                                    <span class="fraction">3/4</span>
                                    <span class="dimension">29cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B14_HALF" data-length="19">
                                    <span class="fraction">1/2</span>
                                    <span class="dimension">19cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B14_1Q" data-length="9">
                                    <span class="fraction">1/4</span>
                                    <span class="dimension">9cm</span>
                                </button>
                                <button class="block-size-btn custom-cut-btn" data-type="B14" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <!-- Bloc creux B19 -->
                        <div class="block-type-section">
                            <h4>Bloc creux B19 <span class="dimensions">39×19×19 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn" data-type="B19" data-length="39">
                                    <span class="fraction">1/1</span>
                                    <span class="dimension">39cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B19_3Q" data-length="29">
                                    <span class="fraction">3/4</span>
                                    <span class="dimension">29cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B19_HALF" data-length="19">
                                    <span class="fraction">1/2</span>
                                    <span class="dimension">19cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B19_1Q" data-length="9">
                                    <span class="fraction">1/4</span>
                                    <span class="dimension">9cm</span>
                                </button>
                                <button class="block-size-btn custom-cut-btn" data-type="B19" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <!-- Bloc creux B29 -->
                        <div class="block-type-section">
                            <h4>Bloc creux B29 <span class="dimensions">39×29×19 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn" data-type="B29" data-length="39">
                                    <span class="fraction">1/1</span>
                                    <span class="dimension">39cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B29_3Q" data-length="29">
                                    <span class="fraction">3/4</span>
                                    <span class="dimension">29cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B29_HALF" data-length="19">
                                    <span class="fraction">1/2</span>
                                    <span class="dimension">19cm</span>
                                </button>
                                <button class="block-size-btn" data-type="B29_1Q" data-length="9">
                                    <span class="fraction">1/4</span>
                                    <span class="dimension">9cm</span>
                                </button>
                                <button class="block-size-btn custom-cut-btn" data-type="B29" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Personnalisée</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Blocs béton cellulaire -->
                    <div class="block-category-section">
                        <h3 class="category-title">Blocs béton cellulaire</h3>
                        
                        <div class="block-type-section">
                            <h4>Bloc béton cell. <span class="dimensions">60×5×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BC_60x5" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Bloc béton cell. <span class="dimensions">60×7×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BC_60x7" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Bloc béton cell. <span class="dimensions">60×10×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BC_60x10" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Bloc béton cell. <span class="dimensions">60×15×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BC_60x15" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Bloc béton cell. <span class="dimensions">60×17.5×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BC_60x17" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Bloc béton cell. <span class="dimensions">60×20×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BC_60x20" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Bloc béton cell. <span class="dimensions">60×24×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BC_60x24" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Bloc béton cell. <span class="dimensions">60×30×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BC_60x30" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Bloc béton cell. <span class="dimensions">60×36×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BC_60x36" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Blocs Argex -->
                    <div class="block-category-section">
                        <h3 class="category-title">Blocs Argex</h3>
                        
                        <div class="block-type-section">
                            <h4>Bloc Argex <span class="dimensions">39×9×19 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn" data-type="ARGEX_39x9" data-length="39">
                                    <span class="fraction">1/1</span>
                                    <span class="dimension">39cm</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Bloc Argex <span class="dimensions">39×14×19 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn" data-type="ARGEX_39x14" data-length="39">
                                    <span class="fraction">1/1</span>
                                    <span class="dimension">39cm</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Bloc Argex <span class="dimensions">39×19×19 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn" data-type="ARGEX_39x19" data-length="39">
                                    <span class="fraction">1/1</span>
                                    <span class="dimension">39cm</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Béton cellulaire Assise -->
                    <div class="block-category-section">
                        <h3 class="category-title">Béton cellulaire Assise</h3>
                        
                        <div class="block-type-section">
                            <h4>Béton cell. Assise <span class="dimensions">60×9×20 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BCA_60x9x20" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Béton cell. Assise <span class="dimensions">60×14×20 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BCA_60x14x20" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Béton cell. Assise <span class="dimensions">60×19×20 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BCA_60x19x20" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Béton cell. Assise <span class="dimensions">60×9×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BCA_60x9x25" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Béton cell. Assise <span class="dimensions">60×14×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BCA_60x14x25" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Béton cell. Assise <span class="dimensions">60×19×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="BCA_60x19x25" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Terre cuite -->
                    <div class="block-category-section">
                        <h3 class="category-title">Terre cuite</h3>
                        
                        <div class="block-type-section">
                            <h4>Terre cuite <span class="dimensions">50×10×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="TC_50x10" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Terre cuite <span class="dimensions">50×14×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="TC_50x14" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>

                        <div class="block-type-section">
                            <h4>Terre cuite <span class="dimensions">50×19×25 cm</span></h4>
                            <div class="size-buttons">
                                <button class="block-size-btn custom-cut-btn" data-type="TC_50x19" data-custom-cut="true">
                                    <span class="fraction">✂️</span>
                                    <span class="dimension">Coupe personnalisée</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelBlockSelection" class="btn btn-secondary">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Modale de coupe personnalisée -->
    <div id="customCutModal" class="modal">
        <div class="modal-content custom-cut-modal">
            <div class="modal-header">
                <h2 class="custom-cut-title">Coupe personnalisée</h2>
                <button class="close-btn" id="closeCustomCut">&times;</button>
            </div>
            <div class="modal-body">
                <div class="custom-cut-form">
                    <div class="form-group">
                        <label for="customLength">Longueur (cm):</label>
                        <input type="number" id="customLength" min="1" max="200" step="0.1" placeholder="Longueur">
                    </div>
                    <div class="form-group">
                        <label for="customWidth">Largeur (cm):</label>
                        <input type="number" id="customWidth" min="1" max="100" step="0.1" placeholder="Largeur">
                    </div>
                    <div class="form-group">
                        <label for="customHeight">Hauteur (cm):</label>
                        <input type="number" id="customHeight" min="1" max="100" step="0.1" placeholder="Hauteur">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirmCustomCut" class="btn btn-primary">Confirmer</button>
                <button id="cancelCustomCut" class="btn btn-secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modale de sélection d'isolants -->
    <div id="insulationSelector" class="modal">
        <div class="modal-content insulation-selector-modal">
            <div class="modal-header">
                <h2>Sélecteur d'isolants</h2>
                <button class="close-btn" id="closeInsulationSelector">&times;</button>
            </div>
            <div class="modal-body">
                <div class="insulation-selector-content">
                    <!-- Info isolant sélectionné -->
                    <div class="selected-insulation-info">
                        <h3>Isolant sélectionné:</h3>
                        <div class="insulation-info">
                            <span class="insulation-name">Isolant PUR5</span>
                            <span class="insulation-dimensions">120×5×60 cm</span>
                        </div>
                    </div>

                    <!-- Isolants PUR -->
                    <div class="insulation-category-section">
                        <h3 class="category-title">Isolants PUR</h3>
                        
                        <div class="insulation-type-section">
                            <h4>Isolant PUR5 <span class="dimensions">120×5×60 cm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn selected" data-type="PUR5" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                                <button class="insulation-btn" data-type="PUR5" data-customizable="true">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>📏</span>
                                    <span class="dimension">Dimensions personnalisées</span>
                                </button>
                            </div>
                        </div>

                        <div class="insulation-type-section">
                            <h4>Isolant PUR6 <span class="dimensions">120×6×60 cm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="PUR6" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                                <button class="insulation-btn" data-type="PUR6" data-customizable="true">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>📏</span>
                                    <span class="dimension">Dimensions personnalisées</span>
                                </button>
                            </div>
                        </div>

                        <div class="insulation-type-section">
                            <h4>Isolant PUR7 <span class="dimensions">120×7×60 cm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="PUR7" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                                <button class="insulation-btn" data-type="PUR7" data-customizable="true">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>📏</span>
                                    <span class="dimension">Dimensions personnalisées</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Isolants Laine de roche -->
                    <div class="insulation-category-section">
                        <h3 class="category-title">Isolants Laine de roche</h3>
                        
                        <div class="insulation-type-section">
                            <h4>Isolant Laine de roche (120x5x60 cm) <span class="dimensions">120×5×60 cm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="LAINEROCHE5" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                                <button class="insulation-btn" data-type="LAINEROCHE5" data-customizable="true">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>📏</span>
                                    <span class="dimension">Dimensions personnalisées</span>
                                </button>
                            </div>
                        </div>

                        <div class="insulation-type-section">
                            <h4>Isolant laine de roche (120x6x60 cm) <span class="dimensions">120×6×60 cm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="LAINEROCHE6" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                                <button class="insulation-btn" data-type="LAINEROCHE6" data-customizable="true">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>📏</span>
                                    <span class="dimension">Dimensions personnalisées</span>
                                </button>
                            </div>
                        </div>

                        <div class="insulation-type-section">
                            <h4>Isolant laine de roche (120x7x60 cm) <span class="dimensions">120×7×60 cm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="LAINEROCHE7" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                                <button class="insulation-btn" data-type="LAINEROCHE7" data-customizable="true">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>📏</span>
                                    <span class="dimension">Dimensions personnalisées</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Panneaux XPS (Polystyrène Extrudé) - Zones humides -->
                    <div class="insulation-category-section">
                        <h3 class="category-title">Panneaux XPS (Polystyrène Extrudé)</h3>
                        <p class="category-description">Recommandés pour les zones humides comme les sols ou les murs de soubassement</p>
                        
                        <div class="insulation-type-section">
                            <h4>Panneau XPS 20mm <span class="dimensions">125×20×60 mm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="XPS20" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                            </div>
                        </div>

                        <div class="insulation-type-section">
                            <h4>Panneau XPS 30mm <span class="dimensions">125×30×60 mm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="XPS30" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                            </div>
                        </div>

                        <div class="insulation-type-section">
                            <h4>Panneau XPS 40mm <span class="dimensions">125×40×60 mm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="XPS40" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                            </div>
                        </div>

                        <div class="insulation-type-section">
                            <h4>Panneau XPS 50mm <span class="dimensions">125×50×60 mm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="XPS50" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                            </div>
                        </div>

                        <div class="insulation-type-section">
                            <h4>Panneau XPS 60mm <span class="dimensions">125×60×60 mm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="XPS60" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                            </div>
                        </div>

                        <div class="insulation-type-section">
                            <h4>Panneau XPS 80mm <span class="dimensions">125×80×60 mm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="XPS80" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                            </div>
                        </div>

                        <div class="insulation-type-section">
                            <h4>Panneau XPS 100mm <span class="dimensions">125×100×60 mm</span></h4>
                            <div class="insulation-buttons">
                                <button class="insulation-btn" data-type="XPS100" data-customizable="false">
                                    <span class="insulation-icon"><i class="fas fa-check"></i>✅</span>
                                    <span class="dimension">Sélectionner</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelInsulationSelection" class="btn btn-secondary">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Modale de dimensions personnalisées pour isolants -->
    <div id="customInsulationModal" class="modal">
        <div class="modal-content custom-insulation-modal">
            <div class="modal-header">
                <h2 class="custom-insulation-title">Dimensions personnalisées - Isolant PUR5</h2>
                <button class="close-btn" id="closeCustomInsulation">&times;</button>
            </div>
            <div class="modal-body">
                <div class="custom-insulation-form">
                    <div class="form-group">
                        <label for="customInsulationLength">Longueur (cm):</label>
                        <input type="number" id="customInsulationLength" min="1" max="500" step="0.1" placeholder="Longueur" value="120">
                    </div>
                    <div class="form-group">
                        <label for="customInsulationWidth">Largeur (cm):</label>
                        <input type="number" id="customInsulationWidth" min="1" max="100" step="0.1" placeholder="Largeur" value="5">
                    </div>
                    <div class="form-group">
                        <label for="customInsulationHeight">Hauteur (cm):</label>
                        <input type="number" id="customInsulationHeight" min="1" max="300" step="0.1" placeholder="Hauteur" value="60">
                    </div>
                    <div class="dimension-preview">
                        <span class="preview-label">Aperçu:</span>
                        <span class="preview-dimensions" id="insulationDimensionPreview">120×5×60 cm</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirmCustomInsulation" class="btn btn-primary">Confirmer</button>
                <button id="cancelCustomInsulation" class="btn btn-secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Éléments d'interface pour le menu d'édition -->
    <div id="selectionStatus" class="selection-status">
        <i class="fas fa-mouse-pointer"></i>
        <span>0 élément(s) sélectionné(s)</span>
    </div>

    <div id="transformControls" class="transform-controls">
        <div class="transform-label">Transformation</div>
        <div class="transform-group">
            <button id="moveBtn" class="transform-btn" data-mode="move">
                <i class="fas fa-arrows-alt"></i>
                <span>Déplacer</span>
            </button>
            <button id="rotateBtn" class="transform-btn" data-mode="rotate">
                <i class="fas fa-sync-alt"></i>
                <span>Rotation</span>
            </button>
        </div>
        <div class="transform-group">
            <button id="scaleBtn" class="transform-btn" data-mode="scale">
                <i class="fas fa-expand-arrows-alt"></i>
                <span>Redimensionner</span>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/startup-manager.js"></script>
    <script src="js/version-checker.js"></script>
    <script src="js/diagnostic-threejs.js"></script>
    <script src="js/keyboard-manager.js"></script>
    <!-- <script src="js/help-system.js"></script> --> <!-- Temporairement désactivé car corrompu -->
    <script src="js/help-patch.js"></script>
    <script src="js/help-window-manager.js"></script>
    <script src="js/library-help-system.js"></script>
    <script src="js/tools-help-system.js"></script>
    <script src="js/toolbar-help-system.js"></script>
    <script src="js/materials.js"></script>
    <script src="js/extended-material-manager.js"></script>
    <script src="js/material-painter.js"></script>
    <script src="js/wall-element.js?v=20250811-1045-BLOCKTYPE-FINAL-FIX"></script>
    <script src="js/assise-manager.js"></script>
    <script src="js/cut-button-manager.js"></script>
    <script src="js/tools-tab-manager.js"></script>
    <script src="js/tools-reusable-panel-fixed.js"></script>
    <script src="js/scene-manager.js?v=20250823-FIX-PLACEMENT-DIMENSIONS-V8"></script>
    <script src="js/scene-manager-extensions.js"></script>
    <script src="js/brick-selector.js?v=20250823-FIX-M50-PRESERVATION-V9"></script>
    <script src="js/height-control-manager.js"></script>
    <script src="js/block-selector.js"></script>
    <script src="js/insulation-selector.js"></script>
    <script src="js/linteau-selector.js"></script>
    <script src="js/construction-tools.js?v=20250823-FIX-GHOST-UPDATE-V8"></script>
    <script src="debug-delete-icon.js"></script>
    <script src="js/layer-manager.js"></script>
    <script src="js/analysis.js"></script>
    <script src="js/rich-text-editor.js"></script>
    <script src="js/tab-manager.js"></script>
    <script src="js/shadow-manager.js"></script>
    <script src="js/library-preview-3d.js"></script>
    <script src="js/library-visibility-manager.js"></script>
    <script src="js/file-menu-handler.js"></script>
    <script src="js/edit-menu-handler.js"></script>
    <script src="js/modern-interface.js"></script>
    <script src="js/ui-controller.js"></script>
    <script src="js/toolbar-manager.js"></script>
    <script src="js/measurement-tool.js"></script>
    <script src="js/annotation-tool.js"></script>
    <script src="js/text-leader-tool.js"></script>
    <script src="js/measurement-annotation-manager.js"></script>
    <script src="js/metre-tab-manager.js"></script>
    <script src="js/glb-dpad-controller.js"></script>
    <script src="js/onboarding-system-clean.js"></script>
    <!-- Outils de développement supprimés -->
    <script src="js/app.js"></script>
    <script src="js/diagnostic.js"></script>
    <script src="js/init.js"></script>
    
    <!-- Script de sécurité pour afficher l'interface si le popup ne s'affiche pas -->
    <script>
        // Délai de sécurité pour s'assurer que l'interface s'affiche même si le popup ne fonctionne pas
        setTimeout(() => {
            if (!document.body.classList.contains('startup-loaded')) {
                // console.log('⚠️ Délai de sécurité atteint - affichage forcé de l\'interface');
                document.body.classList.add('startup-loaded');
            }
        }, 3000); // 3 secondes de délai de sécurité
    </script>
    
    <!-- Test Debug Menu Affichage avec Action Directe -->
    <script>
        window.addEventListener('load', () => {
            setTimeout(() => {
                // console.log('🧪 [DEBUG FINAL] Test des boutons menu Affichage avec actions directes');
                
                // Créer des fonctions globales de test
                window.testViewTop = () => {
                    console.log('🎯 Test direct viewTop');
                    if (window.modernInterface && window.modernInterface.setView) {
                        window.modernInterface.setView('top');
                        console.log('✅ setView(top) exécuté');
                    }
                };
                
                window.testViewFront = () => {
                    console.log('🎯 Test direct viewFront');
                    if (window.modernInterface && window.modernInterface.setView) {
                        window.modernInterface.setView('front');
                        console.log('✅ setView(front) exécuté');
                    }
                };
                
                window.testWireframe = () => {
                    console.log('🎯 Test direct wireframe');
                    if (window.modernInterface && window.modernInterface.toggleWireframe) {
                        window.modernInterface.toggleWireframe();
                        console.log('✅ toggleWireframe() exécuté');
                    }
                };
                
                // Forcer l'ajout d'event listeners sur les boutons de menu
                const menuButtons = ['viewTop', 'viewFront', 'viewSide'];
                menuButtons.forEach(buttonId => {
                    const btn = document.getElementById(buttonId);
                    if (btn) {
                        // console.log(`🔧 [FORCE] Ajout listener sur ${buttonId}`);
                        
                        // Supprimer tous les listeners existants (si possible)
                        const newBtn = btn.cloneNode(true);
                        btn.parentNode.replaceChild(newBtn, btn);
                        
                        // Ajouter un nouveau listener simple
                        newBtn.addEventListener('click', (e) => {
                            // console.log(`🎯 [FORCE] Click forcé sur ${buttonId}`);
                            e.stopPropagation();
                            e.preventDefault();
                            
                            if (window.modernInterface) {
                                window.modernInterface.handleMenuAction(buttonId);
                            } else {
                                console.log('❌ window.modernInterface non disponible');
                            }
                        });
                        
                    }
                });
                
                // console.log('� Testez en console: testViewTop(), testViewFront(), testWireframe()');
                
            }, 3000);
        });
    </script>

    <!-- Menu de contrôle de hauteur pour briques sur chant -->
    <div id="heightControlPanel" class="height-control-panel" style="display: none;">
        <div class="height-control-header">
            <h4><i class="fas fa-arrows-alt-v"></i> Contrôle de hauteur - Brique sur chant</h4>
            <button class="height-control-close" id="heightControlClose">×</button>
        </div>
        <div class="height-control-body">
            <div class="current-height-display">
                <label>Hauteur actuelle :</label>
                <span id="currentHeightValue">0.0 cm</span>
            </div>
            
            <div class="height-input-section">
                <label for="targetHeight">Hauteur cible (cm) :</label>
                <div class="height-input-group">
                    <input type="number" id="targetHeight" min="0" max="500" step="0.1" value="0.0">
                    <button id="applyHeight" class="apply-height-btn">
                        <i class="fas fa-check"></i> Appliquer
                    </button>
                </div>
            </div>

            <div class="height-arrows-section">
                <div class="height-arrows-label">Ajustement rapide :</div>
                <div class="height-arrows-controls">
                    <button class="height-arrow-btn" id="heightUp10" data-delta="10">
                        <i class="fas fa-angle-double-up"></i> +10cm
                    </button>
                    <button class="height-arrow-btn" id="heightUp1" data-delta="1">
                        <i class="fas fa-angle-up"></i> +1cm
                    </button>
                    <button class="height-arrow-btn" id="heightUp01" data-delta="0.1">
                        <i class="fas fa-caret-up"></i> +0.1cm
                    </button>
                    <button class="height-arrow-btn" id="heightDown01" data-delta="-0.1">
                        <i class="fas fa-caret-down"></i> -0.1cm
                    </button>
                    <button class="height-arrow-btn" id="heightDown1" data-delta="-1">
                        <i class="fas fa-angle-down"></i> -1cm
                    </button>
                    <button class="height-arrow-btn" id="heightDown10" data-delta="-10">
                        <i class="fas fa-angle-double-down"></i> -10cm
                    </button>
                </div>
            </div>

            <div class="height-preset-section">
                <div class="height-preset-label">Hauteurs prédéfinies :</div>
                <div class="height-preset-buttons">
                    <button class="height-preset-btn" data-height="0">Sol</button>
                    <button class="height-preset-btn" data-height="20">20cm</button>
                    <button class="height-preset-btn" data-height="40">40cm</button>
                    <button class="height-preset-btn" data-height="60">60cm</button>
                    <button class="height-preset-btn" data-height="80">80cm</button>
                    <button class="height-preset-btn" data-height="100">1m</button>
                    <button class="height-preset-btn" data-height="150">1.5m</button>
                    <button class="height-preset-btn" data-height="200">2m</button>
                </div>
            </div>
        </div>
    </div>

    <style>
    .height-control-panel {
        position: fixed;
        top: 50%;
        right: 20px;
        transform: translateY(-50%);
        width: 300px;
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        border: 2px solid #3498db;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        z-index: 9999;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: white;
    }

    .height-control-header {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        padding: 12px 15px;
        border-radius: 10px 10px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #34495e;
    }

    .height-control-header h4 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
    }

    .height-control-close {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        width: 25px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background-color 0.2s;
    }

    .height-control-close:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }

    .height-control-body {
        padding: 15px;
    }

    .current-height-display {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px;
        border-radius: 6px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .height-input-section {
        margin-bottom: 15px;
    }

    .height-input-section label {
        display: block;
        margin-bottom: 5px;
        font-size: 13px;
        color: #bdc3c7;
    }

    .height-input-group {
        display: flex;
        gap: 10px;
    }

    #targetHeight {
        flex: 1;
        padding: 8px 10px;
        border: 1px solid #34495e;
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 14px;
    }

    #targetHeight:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
    }

    .apply-height-btn {
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        color: white;
        cursor: pointer;
        font-size: 13px;
        transition: transform 0.2s;
    }

    .apply-height-btn:hover {
        transform: scale(1.05);
    }

    .height-arrows-section {
        margin-bottom: 15px;
    }

    .height-arrows-label, .height-preset-label {
        font-size: 13px;
        color: #bdc3c7;
        margin-bottom: 8px;
    }

    .height-arrows-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 5px;
    }

    .height-arrow-btn {
        background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
        border: 1px solid #3498db;
        color: white;
        padding: 8px 6px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s;
    }

    .height-arrow-btn:hover {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        transform: translateY(-1px);
    }

    .height-preset-buttons {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 5px;
    }

    .height-preset-btn {
        background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
        border: none;
        color: white;
        padding: 6px 4px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
        transition: all 0.2s;
    }

    .height-preset-btn:hover {
        background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        transform: scale(1.05);
    }

    #currentHeightValue {
        font-weight: bold;
        color: #3498db;
    }
    </style>
<!-- FONCTIONS DE TEST TEMPORAIRES -->
<script>
function testHeightPanel() {
    console.log('🧪 TEST: Affichage du panneau de hauteur');
    if (window.heightControlManager) {
        window.heightControlManager.showPanel();
        console.log('✅ showPanel() appelé');
    } else {
        console.error('❌ heightControlManager non disponible');
        alert('HeightControlManager non disponible');
    }
}

function testM50Selection() {
    console.log('🧪 TEST: Sélection M50_CHANT');
    if (window.BrickSelector) {
        window.BrickSelector.selectBrick('M50_CHANT');
        console.log('✅ M50_CHANT sélectionné');
    } else {
        console.error('❌ BrickSelector non disponible');
        alert('BrickSelector non disponible');
    }
}

function testBrickSelector() {
    // console.log('🧪 TEST: État BrickSelector');
    // console.log('BrickSelector:', typeof window.BrickSelector);
    // console.log('HeightControlManager class:', typeof HeightControlManager);
    // console.log('heightControlManager instance:', typeof window.heightControlManager);
    
    if (window.BrickSelector) {
        // console.log('Current brick:', window.BrickSelector.currentBrick);
        // console.log('isBrickOnChant method:', typeof window.BrickSelector.isBrickOnChant);
    }
    
    const panel = document.getElementById('heightControlPanel');
    // console.log('Panel element:', panel);
    if (panel) {
        // console.log('Panel display:', panel.style.display);
    }
}

// Test automatique au chargement
setTimeout(() => {
    // console.log('🧪 Tests automatiques au chargement...');
    testBrickSelector();
}, 2000);
</script>

<!-- Modale d'ajout d'outil/objet manuel - Version propre -->
<div id="manualItemModal" class="manual-tool-modal" style="display: none;">
    <div class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3><i class="fas fa-tools"></i> Ajouter un Outil</h3>
                <button class="close-btn" id="closeManualItem">&times;</button>
            </div>
            
            <div class="modal-content">
                <div class="form-row">
                    <label for="manualItemName">Nom :</label>
                    <input type="text" id="manualItemName" placeholder="Ex: Truelle, Niveau..." required>
                </div>
                
                <div class="form-row">
                    <label for="manualItemCategory">Catégorie :</label>
                    <select id="manualItemCategory">
                        <option value="tool">Outil</option>
                        <option value="material">Matériau</option>
                        <option value="equipment">Équipement</option>
                        <option value="safety">Sécurité</option>
                        <option value="misc">Divers</option>
                    </select>
                </div>
                
                <div class="form-row-inline">
                    <div class="form-col">
                        <label for="manualItemQuantity">Quantité :</label>
                        <input type="number" id="manualItemQuantity" min="1" value="1" step="1">
                    </div>
                    <div class="form-col">
                        <label for="manualItemUnit">Unité :</label>
                        <select id="manualItemUnit">
                            <option value="unité">unité(s)</option>
                            <option value="kg">kg</option>
                            <option value="l">litre(s)</option>
                            <option value="m">mètre(s)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <label for="manualItemPrice">Prix (€) :</label>
                    <input type="number" id="manualItemPrice" min="0" step="0.01" placeholder="Optionnel">
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="confirmManualItem" class="btn-primary">
                    <i class="fas fa-plus"></i> Ajouter
                </button>
                <button id="cancelManualItem" class="btn-secondary">Annuler</button>
            </div>
        </div>
    </div>
</div>

<style>
/* Forcer les couleurs du thème sombre pour les joints */
.joint-title, span.joint-title {
    color: #e0e6ed !important;
}

.joint-description, span.joint-description {
    color: #a0a8b0 !important;
}

/* Corriger le fond blanc du conteneur joint-info */
.joint-info {
    background: transparent !important;
    background-color: transparent !important;
}

/* Styles pour le container moderne des joints */
.joints-controls-modern .joint-title {
    color: #e0e6ed !important;
}

.joints-controls-modern .joint-description {
    color: #a0a8b0 !important;
}

.joints-controls-modern .joint-info {
    background: transparent !important;
    background-color: transparent !important;
}

/* Amélioration du style du panneau d'informations élément - Style moderne unifié */
.element-info {
    background: rgba(40, 40, 45, 0.95) !important;
    border: 1px solid rgba(70, 130, 180, 0.2) !important;
    border-radius: 12px !important;
    padding: 0 !important;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
    backdrop-filter: blur(10px) !important;
    margin: 10px 0 !important;
    overflow: hidden !important;
}

.element-info.selected {
    border-color: rgba(70, 130, 180, 0.5) !important;
    box-shadow: 0 0 15px rgba(70, 130, 180, 0.15), 0 4px 20px rgba(0, 0, 0, 0.3) !important;
}

/* Header style similaire aux joints */
.element-info h4 {
    background: rgba(50, 50, 55, 0.8) !important;
    color: #e0e6ed !important;
    font-size: 14px !important;
    font-weight: 600 !important;
    margin: 0 !important;
    padding: 16px 20px !important;
    border-bottom: 1px solid rgba(70, 130, 180, 0.2) !important;
    display: flex !important;
    align-items: center !important;
    gap: 10px !important;
}

.element-info h4::before {
    content: "🔧" !important;
    font-size: 16px !important;
    opacity: 0.8 !important;
}

/* Container pour les propriétés */
.element-info > div:not(h4) {
    padding: 20px !important;
}

/* Style des lignes de propriétés similaire aux joint-option */
.property-row {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 12px 16px !important;
    margin: 0 -16px 8px -16px !important;
    background: rgba(60, 60, 65, 0.3) !important;
    border-radius: 8px !important;
    border: 1px solid rgba(255, 255, 255, 0.05) !important;
    transition: all 0.2s ease !important;
}

.property-row:last-child {
    margin-bottom: 0 !important;
}

.property-row:hover {
    background: rgba(70, 130, 180, 0.1) !important;
    border-color: rgba(70, 130, 180, 0.2) !important;
    transform: translateX(2px) !important;
}

/* Labels des propriétés - style joint-title */
.property-row strong {
    color: #a0a8b0 !important;
    font-weight: 500 !important;
    font-size: 13px !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
    min-width: 90px !important;
    opacity: 0.9 !important;
}

/* Valeurs des propriétés - style joint-description */
.property-row span {
    color: #e0e6ed !important;
    font-weight: 400 !important;
    font-size: 13px !important;
    background: rgba(70, 130, 180, 0.15) !important;
    padding: 6px 12px !important;
    border-radius: 6px !important;
    font-family: 'Segoe UI', Arial, sans-serif !important;
    border: 1px solid rgba(70, 130, 180, 0.1) !important;
}

/* Couleurs spécifiques pour différents types de valeurs */
.property-value-id {
    background: rgba(76, 175, 80, 0.2) !important;
    color: #81c784 !important;
    border-color: rgba(76, 175, 80, 0.3) !important;
}

.property-value-coordinates {
    background: rgba(255, 152, 0, 0.2) !important;
    color: #ffb74d !important;
    border-color: rgba(255, 152, 0, 0.3) !important;
}

/* Footer copyright */
.app-footer {
    position: fixed;
    bottom: 0;
    right: 0;
    background: rgba(30, 30, 30, 0.9);
    color: rgba(255, 255, 255, 0.6);
    padding: 4px 8px;
    font-size: 10px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    border-top-left-radius: 4px;
    z-index: 9999;
    user-select: none;
    pointer-events: none;
}

.app-footer:hover {
    background: rgba(40, 40, 40, 0.95);
    color: rgba(255, 255, 255, 0.8);
}

/* Modal À propos */
.about-modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
}

.about-modal-content {
    background-color: #2d3436;
    margin: 10% auto;
    padding: 0;
    border: none;
    border-radius: 12px;
    width: 500px;
    max-width: 90%;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    overflow: hidden;
}

.about-modal-header {
    background: linear-gradient(135deg, #4a90e2, #357abd);
    color: white;
    padding: 20px;
    text-align: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.about-modal-header h2 {
    margin: 0;
    font-size: 24px;
    font-weight: 300;
}

.about-modal-body {
    padding: 30px;
    color: #e0e6ed;
    line-height: 1.6;
}

.about-info {
    text-align: center;
    margin-bottom: 25px;
}

.about-logo {
    font-size: 48px;
    color: #4a90e2;
    margin-bottom: 15px;
}

.about-version {
    background: rgba(74, 144, 226, 0.2);
    color: #4a90e2;
    padding: 8px 16px;
    border-radius: 20px;
    display: inline-block;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 20px;
}

.about-description {
    font-size: 16px;
    margin-bottom: 20px;
    color: #b2bac2;
}

.about-copyright {
    background: rgba(255, 193, 7, 0.1);
    border-left: 4px solid #ffc107;
    padding: 15px;
    margin: 20px 0;
    border-radius: 0 8px 8px 0;
}

.about-copyright strong {
    color: #ffc107;
    display: block;
    margin-bottom: 8px;
}

.about-tech {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.tech-item {
    background: rgba(255, 255, 255, 0.05);
    padding: 12px;
    border-radius: 8px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.tech-item i {
    font-size: 24px;
    color: #4a90e2;
    margin-bottom: 8px;
    display: block;
}

.about-close {
    color: white;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    opacity: 0.7;
    position: absolute;
    right: 20px;
    top: 15px;
}

.about-close:hover {
    opacity: 1;
}
</style>

<!-- Modal À propos -->
<div id="aboutModal" class="about-modal">
    <div class="about-modal-content">
        <div class="about-modal-header">
            <span class="about-close">&times;</span>
            <h2><i class="fas fa-cube"></i> WalSim5D</h2>
        </div>
        <div class="about-modal-body">
            <div class="about-info">
                <div class="about-logo">
                    <i class="fas fa-cube"></i>
                </div>
                <div class="about-version">Version 1.0</div>
                <div class="about-description">
                    Simulateur professionnel de construction murale en 3D
                </div>
            </div>
            
            <div class="about-copyright">
                <strong><i class="fas fa-copyright"></i> Droits d'auteur</strong>
                © 2025 WalSim5D - Tous droits réservés.<br>
                Ce logiciel est protégé par la licence MIT.<br>
                Utilisation commerciale non autorisée sans permission expresse.
            </div>
            
            <div class="about-tech">
                <div class="tech-item">
                    <i class="fab fa-js-square"></i>
                    JavaScript ES6+
                </div>
                <div class="tech-item">
                    <i class="fas fa-cube"></i>
                    Three.js
                </div>
                <div class="tech-item">
                    <i class="fab fa-html5"></i>
                    HTML5
                </div>
                <div class="tech-item">
                    <i class="fab fa-css3-alt"></i>
                    CSS3
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Footer avec copyright -->
<div class="app-footer">
    © 2025 WalSim5D - Tous droits réservés
</div>

<!-- Script pour la modal À propos -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const aboutBtn = document.getElementById('aboutApp');
    const aboutModal = document.getElementById('aboutModal');
    const aboutClose = document.querySelector('.about-close');
    
    // Ouvrir la modal
    if (aboutBtn) {
        aboutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            aboutModal.style.display = 'block';
        });
    }
    
    // Fermer la modal
    if (aboutClose) {
        aboutClose.addEventListener('click', function() {
            aboutModal.style.display = 'none';
        });
    }
    
    // Fermer en cliquant à l'extérieur
    aboutModal.addEventListener('click', function(e) {
        if (e.target === aboutModal) {
            aboutModal.style.display = 'none';
        }
    });
    
    // Fermer avec Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && aboutModal.style.display === 'block') {
            aboutModal.style.display = 'none';
        }
    });
});
</script>

</body>
</html>
